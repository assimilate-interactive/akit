!function(){"use strict";class e{constructor(e,t,i,r){this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.VIEW_ANGLE=e,this.ASPECT=t,this.NEAR=i,this.FAR=r,this.camera=new THREE.PerspectiveCamera(this.VIEW_ANGLE,this.ASPECT,this.NEAR,this.FAR),this.name=APP.cameraName,this.position=APP.cameraPosition}init(){}setPosition(e){this.camera.position.x=e.x,this.camera.position.y=e.y,this.camera.position.z=e.z}cycle(){this.pan()}pan(){}}class t{constructor(){}init(){this.ambientBasic(),this.sceneOne()}ambientBasic(){AKIT.scene.scene.add(new THREE.AmbientLight(16777215))}directionalShadow(e,t,i,r,s,o,a,n){const h=new THREE.DirectionalLight(r,1.75);h.position.set(e,t,i),h.castShadow=!0,h.shadow.mapSize.width=a,h.shadow.mapSize.height=n,h.shadow.camera.left=-s,h.shadow.camera.right=s,h.shadow.camera.top=s,h.shadow.camera.bottom=-s,h.shadow.camera.far=o,AKIT.scene.scene.add(h)}sceneOne(){var e=new THREE.DirectionalLight(new THREE.Color("hsl(30, 100%, 75%)"),1);e.position.set(-100,0,100);var t=new THREE.DirectionalLight(new THREE.Color("hsl(240, 100%, 75%)"),.75);t.position.set(100,0,100);var i=new THREE.DirectionalLight(16777215,1);i.position.set(100,0,-100).normalize(),AKIT.scene.scene.add(e),AKIT.scene.scene.add(t),AKIT.scene.scene.add(i)}}class i{constructor(e){this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.VIEW_ANGLE=APP.cameraDistanceViewAngle,this.ASPECT=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,this.NEAR=APP.cameraDistanceNear,this.FAR=APP.cameraDistanceFar,this.RSIZE=1,this.sceneType=APP.sceneType,this.windowLoaded=!1,null!=AKIT.canvas&&0!=AKIT.canvas||(AKIT.canvas=document.createElement("canvas")),this.scene=new THREE.Scene,this.effects={},this.options=e,APP.displayStats&&(this.stats=new Stats),window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("load",this.onWindowLoad,!1)}init(){this.initCamera(),this.setStats&&(this.stats.domElement.style.position="absolute",this.stats.domElement.style.bottom="0px",this.stats.domElement.style.zIndex=100,AKIT.container.appendChild(this.stats.domElement)),this.initLight(),this.renderer(),this.window()}renderer(){let e=APP.rendererOptions;e.canvas=AKIT.canvas,APP.renderer=new THREE.WebGLRenderer(e),APP.renderer.setPixelRatio(window.devicePixelRatio),APP.renderer.gammaOutput=!0}reset(){this.scene=new THREE.Scene,this.light.init()}setSceneProperties(){}setVR(){APP.renderer.vr.enabled=!0}stats(){this.setStats&&this.stats.update()}render(){APP.renderer.render(this.scene,this.camera)}inworld(e){return-1!=this.scene.children.indexOf(e)}window(){this.SCREEN_WIDTH=AKIT.windowWidth,this.SCREEN_HEIGHT=AKIT.windowHeight,this.ASPECT=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,APP.renderer.setSize(this.SCREEN_WIDTH/this.RSIZE,this.SCREEN_HEIGHT/this.RSIZE),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix(),null!=AKIT.control&&AKIT.control.resize(),AKIT.alogKit(" (sys-resize-window) "+this.SCREEN_WIDTH+" "+this.SCREEN_HEIGHT)}windowSet(e,t){this.SCREEN_WIDTH=e,this.SCREEN_HEIGHT=t,this.ASPECT=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,APP.renderer.setSize(this.SCREEN_WIDTH/this.RSIZE,this.SCREEN_HEIGHT/this.RSIZE),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix(),null!=AKIT.control&&AKIT.control.resize(),AKIT.alogKit(" (sys-resize) "+this.SCREEN_WIDTH+" "+this.SCREEN_HEIGHT)}initLight(){this.light=new t,this.light.init()}initCamera(){null==this.sceneType||"standard"==this.sceneType?this.sceneCamera=new AKIT_SceneCamera(this.VIEW_ANGLE,this.ASPECT,this.NEAR,this.FAR):"simple"==this.sceneType||"vr"==this.sceneType?this.sceneCamera=new e(this.VIEW_ANGLE,this.ASPECT,this.NEAR,this.FAR):"peppers"==this.sceneType&&(this.sceneCamera=new AKIT_SceneCameraPeppersGhost(this.VIEW_ANGLE,this.ASPECT,this.NEAR,this.FAR)),this.camera=this.sceneCamera.camera,this.listener=this.sceneCamera.listener,this.startCamera(),this.sceneCamera.init()}startCamera(){null==this.sceneType||"standard"==this.sceneType||"simple"==this.sceneType?(this.scene.add(this.camera),this.camera.position.set(APP.cameraPositionX,APP.cameraPositionY,APP.cameraPositionZ),this.camera.lookAt(this.scene.position)):"vr"==this.sceneType?(this.scene.add(this.camera),this.camera.position.set(APP.cameraPositionX,APP.cameraPositionY,APP.cameraPositionZ)):"peppers"==this.sceneType&&this.sceneCamera.start(this.SCREEN_WIDTH,this.SCREEN_HEIGHT,APP.cameraDistance)}resetCamera(){null==this.sceneType||"standard"==this.sceneType||"simple"==this.sceneType?(this.camera.position.set(APP.cameraPositionX,APP.cameraPositionY,APP.cameraPositionZ),this.camera.lookAt(this.scene.position)):"vr"==this.sceneType?this.camera.position.set(APP.cameraPositionX,APP.cameraPositionY,APP.cameraPositionZ):"peppers"==this.sceneType&&this.sceneCamera.start(this.SCREEN_WIDTH,this.SCREEN_HEIGHT,APP.cameraDistance)}cameraSet(e){this.sceneCamera.transition(e)}fullScreen(){}fullScreenExit(){}onWindowResize(e){APP.run.resize(),AKIT.scene.window()}onWindowLoad(e){this.windowLoaded=!0}}window.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1};class r{constructor(e){this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.VIEW_ANGLE=APP.cameraDistanceViewAngle,this.ASPECT=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,this.NEAR=APP.cameraDistanceNear,this.FAR=APP.cameraDistanceFar,this.RSIZE=1,this.sceneType=APP.sceneType,this.windowLoaded=!1,null!=AKIT.canvas&&0!=AKIT.canvas||(AKIT.canvas=document.createElement("canvas"),AKIT.canvas.height=this.SCREEN_HEIGHT,AKIT.canvas.width=this.SCREEN_WIDTH),this.scene=new THREE.Scene,this.effects={},this.options=e,APP.displayStats&&(this.stats=new Stats),window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("load",this.onWindowLoad,!1)}init(){this.setStats&&(this.stats.domElement.style.position="absolute",this.stats.domElement.style.bottom="0px",this.stats.domElement.style.zIndex=100,AKIT.container.appendChild(this.stats.domElement)),this.initLight(),this.window()}cameraSet(e){this.camera=e}renderer(e){let t=e;return t.antialias=!0,APP.renderer=new THREE.WebGLRenderer(t),APP.renderer}reset(){this.scene=new THREE.Scene,this.light.init()}stats(){this.setStats&&this.stats.update()}render(){APP.renderer.render(this.scene,this.camera)}inworld(e){return-1!=this.scene.children.indexOf(e)}window(){this.SCREEN_WIDTH=AKIT.windowWidth,this.SCREEN_HEIGHT=AKIT.windowHeight,this.ASPECT=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,null!=AKIT.control&&AKIT.control.resize(),AKIT.alogKit(" (sys-resize-window) "+this.SCREEN_WIDTH+" "+this.SCREEN_HEIGHT)}initLight(){this.light=new t,this.light.init()}onWindowResize(e){APP.run.resize(),AKIT.scene.window()}onWindowLoad(e){this.windowLoaded=!0}}class s{constructor(){AKIT={},AKIT.system=0,AKIT.scene=0,AKIT.canvas=0,AKIT.renderer=0,AKIT.objectIDCount=0,AKIT.container=0,AKIT.workerTimeDelay=[],AKIT.clock=new THREE.Clock,AKIT.InteractionModes={MOUSE:1,TOUCH:2,VR_0DOF:3,VR_3DOF:4,VR_6DOF:5},AKIT.InteractionMode=2,AKIT.running=!1,AKIT.ready=!1,AKIT.windowHeight=window.innerHeight,AKIT.windowWidth=window.innerWidth,AKIT.loadedAR=!1,AKIT.getSceneObject=function(){return"aframe"==APP.system?new r:new i},AKIT.akitTest=function(){},AKIT.initobjectStore=function(){null!=AKIT.objectStore&&(AKIT.objectStore=new AKIT_ObjectStore)},Array.prototype.store=function(e){this[e].store();const t=this.slice(e+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,t)},Array.prototype.remove=function(e,t){const i=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,i)},AKIT.getRand=function(){return _.random(0,1e5)},AKIT.getValueRGBAString=function(e,t,i,r){return AKIT.getRGBAString(Math.round(255*e),Math.round(255*t),Math.round(255*i),r)},AKIT.getRGBAString=function(e,t,i,r){return"rgba("+e+","+t+","+i+","+r+")"},AKIT.objToString=function(e){let t="";for(const i in e)e.hasOwnProperty(i)&&(t+=i+",");return t},AKIT.getAngleDeg=function(e,t){return Math.atan2(t,e)*pi_half},AKIT.setDefaultImage=function(){AKIT.defaultImage=new Image},AKIT.akitError=function(e){console.log("ERROR: "+e)},AKIT.alogApp=function(e){console.log("APP:"+e)},AKIT.alogAppP=function(e){console.log("APP:"+e)},AKIT.alogAppA=function(e){console.log("AR-APP:"+e)},AKIT.alogKit=function(e){console.log("KIT: "+e)},AKIT.alogKitP=function(e){},AKIT.alogKitCtl=function(e){console.log("CTL: "+e)},AKIT.alogKitCtl2=function(e){},AKIT.akitError=function(e,t){console.log("ERROR:  "+e+" "+JSON.stringify(t))},AKIT.alogApp=function(e){console.log("APP:"+e)},AKIT.alogAppP=function(e){console.log("APP:"+e)},AKIT.alogApp3=function(e){},AKIT.alogApp2=function(e){},AKIT.alogFrame=function(e){},AKIT.alogAppObj=function(e){},AKIT.alogAppCycle=function(e){},AKIT.alogAppObj2Cycle=function(e){},AKIT.aloggerApp=function(e,t){},AKIT.aloggerEvent=function(e){},AKIT.alogDB=function(e){console.log("DEBUG: "+e)},AKIT.alogPreload=function(e){console.log("PRELOAD: "+e)},AKIT.aloggerKit=function(e){},AKIT.aloggerKitURL=function(e){},AKIT.aloggerKitP=function(e){},AKIT.aloggerKitS=function(e){},AKIT.aloggerKitV=function(e){},AKIT.aloggerCtlKit=function(e){},AKIT.aloggerCtlKit2=function(e){},AKIT.aloggerKitPW=function(e){}}}class o{constructor(){APP={platformAR:"arjs",language:"en",system:"aframe",protocolProduction:window.location.protocol,hostProduction:window.location.hostname,portProduction:window.location.port,objDirProduction:"data/objects/",markerDirProduction:"data/marker/",protocolDevelopment:window.location.protocol,hostDevelopment:window.location.hostname,portDevelopment:window.location.port,objDirDevelopment:"assets/model/",markerDirDevelopment:"assets/marker/",debug:{devices:{}},pages:{wechat:"/info"},video:{width:8,height:8,imageWidth:320,imageHeight:240},mediaDevices:{parameters:{sourceType:"webcam",sourceUrl:null,deviceId:null,sourceWidth:480,sourceHeight:640,displayWidth:640,displayHeight:480},parameters2:{sourceType:"webcam",sourceUrl:null,deviceId:null,sourceWidth:640,sourceHeight:480,displayWidth:640,displayHeight:480}},arjs:{markerDistance:1e3,cameraParametersUrl:"/lib/platform/arjs/camera_para.dat",patternUrl:APP.markerDirectory,parameters:{}},webxr:{},"8wall":{},carouselRadius:100,controlRadius:5,itemProperties:{widthD:45,heightD:60,width:6,height:6}};APP.markers=[{name:"1",marker:"pattern-marker.patt",scheme:"objectPerMarker"},{name:"2",marker:"pattern-marker.patt",scheme:"objectPerMarker"}],APP.properties={video:{scale:.15,rotate:{x:-.5,y:0,z:0},ui:"rotate",extension:"mp4",url:"/",location:"file",loader:"spinner"},obj:{scale:.15,rotate:{x:0,y:-.6,z:0},ui:"rotate",url:"/",location:"file",loader:"spinner"},gltf:{scale:.5,rotate:{x:0,y:0,z:0},ui:"rotate",url:"/",location:"file",loader:"spinner"}},APP.preload={ARTypePlaneVideoEffectVignette:{number:3,args:[APP.video.width,APP.video.height,APP.video.imageWidth,APP.video.imageHeight,"","",!1]}};AKIT.loaded=!1,APP.directory=0,APP.renderer=0,APP.displayStats=!1,APP.currentPreset={app:{system:"local",scene:"simple"},camera:{cameraDistanceFar:1e4,cameraDistanceNear:.1,cameraDistanceViewAngle:45,cameraPositionX:0,cameraPositionY:0,cameraPositionZ:0,cameraTargetX:0,cameraTargetY:0,cameraTargetZ:0}},APP.sceneType=APP.currentPreset.app.scene,APP.cameraDistanceFar=APP.currentPreset.camera.cameraDistanceFar,APP.cameraDistanceNear=APP.currentPreset.camera.cameraDistanceNear,APP.cameraDistanceViewAngle=APP.currentPreset.camera.cameraDistanceViewAngle,APP.cameraPositionX=APP.currentPreset.camera.cameraPositionX,APP.cameraPositionY=APP.currentPreset.camera.cameraPositionY,APP.cameraPositionZ=APP.currentPreset.camera.cameraPositionZ,APP.cameraName="camera1",APP.hostname=window.document.hostname}}class a{constructor(){this.properties=new o,this.global=new s}init(){this.platform(),this.asset(),this.anchor()}set(){}platform(){AFRAME.registerSystem("akit",{schema:{platform:{type:"string",default:"arjs"}},init:function(){APP.platformAR=this.data.platform,console.log("akit-platform-init:"+APP.platformAR),akit.start()},tick:function(){akit.cycle()}})}anchor(){AFRAME.registerPrimitive("a-anchor",AFRAME.utils.extendDeep({},AFRAME.primitives.getMeshMixin(),{defaultComponents:{"akit-anchor":{}},mappings:{name:"akit-anchor.name",group:"akit-anchor.group",marker:"akit-anchor.marker"}}))}asset(){AFRAME.registerComponent("akit-anchor",{schema:{name:{type:"string"},group:{type:"string"},marker:{type:"string"}},init:function(){this.data;for(var e=this.el.getChildEntities(),t=new THREE.Group,i=0;i<e.length;i++){var r=e[i];t.children.push(r.object3D)}window.akit.objectAnchor(this.data.name,this.data.group,this.data.marker,t)}})}}class n{constructor(){this.browser="generic",this.init()}init(){this.setBrowser(),this.setHost()}setBrowser(){return window.navigator.userAgent.indexOf("Firefox")>-1&&(this.browser="firefox"),window.navigator.userAgent.indexOf("Chrome")>-1&&(this.browser="chrome"),window.navigator.userAgent.indexOf("Edge")>-1&&(this.browser="edge"),!1}setHost(){"localhost"==window.location.hostname||"127.0.0.1"==window.location.hostname?(APP.host=APP.protocolDevelopment+"//"+APP.hostDevelopment+":"+APP.portDevelopment+"/",APP.objDir=APP.objDirDevelopment,APP.markerDirectory=APP.markerDirDevelopment):(APP.host=APP.protocolProduction+"//"+APP.hostProduction+":"+APP.portProduction+"/",APP.objDir=APP.objDirProduction,APP.markerDirectory=APP.markerDirProduction),AKIT.alogApp("(directory) host:"+APP.host+" obj:"+APP.objDir+" marker:"+APP.markerDirectory)}}class c{constructor(){Object.defineProperty(this,"id",{value:AKIT.objectIDCount++}),this.parent,this.properties={},this.properties_id={},this.child={},this.child_id={},this.cache={},this.properties.debug=!1,this.properties.color=16777215}setType(e,t){this.type=e,this.ident=null==t?e:t,this.name="uid_"+this.id+"_"+this.ident}promise(){}addProperty(e,t){AKIT.alogKit("(aobj-property): "+e+" "+t),this.properties[e]=t}addPropertyId(e,t,i){this.addProperty(e,t),this.properties_id[e]=e+"_"+i}getProperty(e){return this.properties[e]}restoreProperty(e,t,i){this.properties_id[e]}doesPropertyExist(e,t){if(this.properties_id[e]==e+"_"+t)return!0}setParent(e){this.parent=e}addChild(e,t,i){let r=this.setChildId(i);AKIT.alogKit("(aobj-child): "+e+"  "+r),this.child[e]=t,null!=i&&(this.child_id[e]=r)}getChild(e){return this.child[e]}setChild(e,t,i){let r=this.setChildId(i);this.child[e]=t,this.child_id[e]=r}setChildId(e){return this.type+"_"+e}unsetChild(e){this.child[e]=null,delete this.child[e],this.child_id[e]=null,delete this.child_id[e]}storeChild(e){this.storeIfChild(e)&&this.unsetChild(e)}storeIfChild(e){let t=this.child_id[e];if(null!=t){let i=this.child[e];if(null!=i)return AKIT.store.storeObject(t,i),!0}return!1}restoreChild(e,t){let i=this.setChildId(e);var r=AKIT.store.restoreObject(i,t);if(null!=r)return r}caller(e){this.caller=e}call(e,t){null!=this.caller&&this.caller.call(e,t)}}class d extends c{constructor(e){super(),this.parent=e}init(e,t,i,r){this.properties.min=e,this.properties.max=t,this.properties.start=0,this.properties.time=i,this.properties.fader={},this.properties.fader.type=r,this.initFader(this.properties.start,this.properties.time,r)}set(e){this.setFader(e)}fade(e){this.fadeTarget(e)}none(){this.setFader(0)}low(){this.fade(this.properties.min)}high(){this.fade(this.properties.max)}visible(){this.setFader(this.properties.max)}update(){this.updateFader()}initFader(e,t,i){this.properties.fader={},this.properties.fader.start=e,this.properties.fader.time=t,this.properties.fader.value=0,this.properties.fader.type=i,this.properties.fader.target=e,this.properties.fader.targeting=!1,this.properties.fader.timeSegment=0,this.properties.fader.timeEnd=0}fadeTarget(e){if(this.properties.fader.target!=e){this.properties.fader.target=e,this.properties.fader.targetStart=this.properties.fader.value;let t=e-this.properties.fader.value;this.properties.fader.timeSegment=Math.abs(t*this.properties.fader.time),this.properties.fader.timeEnd=Date.now()+this.properties.fader.timeSegment,t<0&&(t=0),t>1&&(t=1),this.properties.fader.targetSeg=Math.abs(t),this.properties.fader.targeting=!0}}setFader(e){this.properties.fader.value!=e&&("material"==this.properties.fader.type?this.parent.setOpacity(e):"particle"==this.properties.fader.type?this.parent.particleSetOpacity(e):"particleEmitter"==this.properties.fader.type?this.parent.particleSetOpacity(e):"attribute"==this.properties.fader.type&&this.parent.attributeSetAlphaCustom(e),this.properties.fader.value=e)}updateFader(){if(1==this.properties.fader.targeting)if(Date.now()<this.properties.fader.timeEnd){const e=1-(this.properties.fader.timeEnd-Date.now())/this.properties.fader.timeSegment;let t=this.properties.fader.targetStart+e*this.properties.fader.targetSeg;t<0&&(t=0),t>1&&(t=1),this.setFader(t)}else this.properties.fader.targeting=!1,this.properties.fader.value=this.properties.fader.target,this.setFader(this.properties.fader.value)}}class l{constructor(){}init(){this.tapTime=400,this.eventStillOverTimeout=100,this.eventStartDownPoint={},this.eventStartDownTime={},this.eventCurrentDownPoint={},this.eventCurrentDownTime={},this.eventStillDownPoint={},this.eventStillDownTime={},this.eventStillOverPoint={},this.eventStillOverTime={},this.eventStillOverDepth={},this.eventStartStillTime={},this.eventStartStillPoint={},this.eventStartStillDownGroup={},this.cacheStillOverDepth={},this.eventControllerOrigin={},this.eventCurrentVelocity={}}clearEvent(e){this.eventStartDownPoint[e]=null,delete this.eventStartDownPoint[e],this.eventCurrentDownPoint[e]=null,delete this.eventCurrentDownTime[e],this.eventStartDownTime[e]=null,delete this.eventStartDownTime[e],this.eventStillDownPoint[e]=null,delete this.eventStillDownPoint[e],this.eventStillDownTime[e]=null,delete this.eventStillDownTime[e],this.eventStillOverPoint[e]=null,delete this.eventStillOverPoint[e],this.eventStillOverTime[e]=null,delete this.eventStillOverTime[e],this.eventStillOverDepth[e]=null,delete this.eventStillOverDepth[e],this.eventStartStillTime[e]=null,delete this.eventStartStillTime[e],this.eventStartStillPoint[e]=null,delete this.eventStartStillPoint[e],this.eventStartStillDownGroup[e]=null,delete this.eventStartStillDownGroup[e],this.eventCurrentVelocity[e]=null,delete this.eventCurrentVelocity[e],this.eventControllerOrigin[e]=null,delete this.eventControllerOrigin[e]}startDownEvent(e,t,i){null==this.eventStartDownPoint[e]&&(this.eventStartDownPoint[e]=new THREE.Vector3(0,0,0));let r=this.eventStillOverPoint[e];null!=r&&(this.eventStartDownTime[e]=Date.now(),this.eventStartDownPoint[e].x=r.x,this.eventStartDownPoint[e].y=r.y,this.eventStartDownPoint[e].z=r.z)}stillDownEvent(e,t,i,r){if(null==this.eventStillDownPoint[e]&&(this.eventStillDownPoint[e]=new THREE.Vector3(0,0,0)),null!=this.eventStartStillTime[e])this.eventStillDownPoint[e].x=this.eventStillOverPoint[e].x,this.eventStillDownPoint[e].y=this.eventStillOverPoint[e].y,this.eventStillDownPoint[e].z=this.eventStillOverPoint[e].z;else{let t=this.getStillDownDepth(e,i);this.eventStillDownPoint[e].x=t.x,this.eventStillDownPoint[e].y=t.y,this.eventStillDownPoint[e].z=t.z}this.setOrigin(e,r),this.stillDownEventGrpAdd(t,e)}stillDownEventEnd(e,t,i){this.eventStartDownTime[e]=null,delete this.eventStartDownTime[e],this.stillDownEventGrpDel(t,e)}stillOverEvent(e,t,i,r,s,o){this.startStillOverEvent(e,t,s,r),null==this.eventStillOverPoint[e]&&(this.eventStillOverPoint[e]=new THREE.Vector3(0,0,0)),this.eventStillOverPoint[e].x=s.x,this.eventStillOverPoint[e].y=s.y,this.eventStillOverPoint[e].z=s.z,this.eventStillOverDepth[e]=s.length(),this.eventStillOverTime[e]=Date.now()}stillOverEventEnd(e,t,i,r,s){this.eventStartStillTime[e]=null,delete this.eventStartStillTime[e]}startStillOverEvent(e,t,i,r){null==this.eventStartStillTime[e]&&(this.eventStartStillTime[e]=Date.now(),null==this.eventStartStillPoint[e]&&(this.eventStartStillPoint[e]=new THREE.Vector3(0,0,0)),this.eventStartStillPoint[e].x=i.x,this.eventStartStillPoint[e].y=i.y,this.eventStartStillPoint[e].z=i.z)}stillOverEventTimer(e){return Date.now()-this.eventStillOverTime[e]>this.eventStillOverTimeout}stillDownEventGrpAdd(e,t){if(null==this.eventStartStillDownGroup[e]&&(this.eventStartStillDownGroup[e]=[]),-1==this.eventStartStillDownGroup[e].indexOf(t)){let i=this.eventStartStillDownGroup[e];i.push(t),this.eventStartStillDownGroup[e]=i}}stillDownEventGrpDel(e,t){null==this.eventStartStillDownGroup[e]&&(this.eventStartStillDownGroup[e]=[]);let i=this.eventStartStillDownGroup[e].indexOf(t);-1!=i&&this.eventStartStillDownGroup[e].remove(i)}getStillDownTime(e){return Date.now()-this.eventStartDownTime[e]}getDistanceStillDown(e){return this.eventStillDownPoint[e].distanceTo(this.eventStartDownPoint[e])}getStillDownDepth(e,t){return null==this.cacheStillOverDepth[e]&&(this.cacheStillOverDepth[e]=new THREE.Vector3(0,0,0)),this.cacheStillOverDepth[e].x=t.x,this.cacheStillOverDepth[e].y=t.y,this.cacheStillOverDepth[e].z=t.z,this.cacheStillOverDepth[e].normalize(),this.cacheStillOverDepth[e].x=this.cacheStillOverDepth[e].x*this.eventStillOverDepth[e],this.cacheStillOverDepth[e].y=this.cacheStillOverDepth[e].y*this.eventStillOverDepth[e],this.cacheStillOverDepth[e].z=this.cacheStillOverDepth[e].z*this.eventStillOverDepth[e],this.cacheStillOverDepth[e]}setOrigin(e,t){null==this.eventControllerOrigin[e]&&(this.eventControllerOrigin[e]=new THREE.Vector3(0,0,0)),null!=t&&(this.eventControllerOrigin[e].x=t.x,this.eventControllerOrigin[e].y=t.y,this.eventControllerOrigin[e].z=t.z)}setVelocity(e){null==this.eventCurrentDownPoint[e]&&(this.eventCurrentDownPoint[e]=new THREE.Vector3(0,0,0),this.eventCurrentVelocity[e]=0);let t=Date.now();const i=t-this.eventCurrentDownTime[e];let r=this.eventStillDownPoint[e].distanceTo(this.eventCurrentDownPoint[e]);this.eventCurrentDownPoint[e].x=this.eventStillDownPoint[e].x,this.eventCurrentDownPoint[e].y=this.eventStillDownPoint[e].y,this.eventCurrentDownPoint[e].z=this.eventStillDownPoint[e].z,this.eventCurrentDownTime[e]=t,this.eventCurrentVelocity[e]=r/i}checkFocusDown(e,t,i){return this.eventCurrentVelocity[e]<i?this.getStillDownTime(e)>t:(this.eventStartDownTime[e]=Date.now(),!1)}resetFocusDown(e){this.eventStartDownTime[e]=Date.now()}checkDown(e){return null!=this.eventStartStillTime[e]}checkTap(e,t){return!!(t.tap&&this.checkTapTime(e)&&this.parent.eventTapCheck(e))}checkTapTime(e){return Date.now()-this.eventStartDownTime[e]<this.tapTime}isActive(){return!1}addObject(e){AKIT.control.addControlObject(e.id,this,e),this.mesh=e}addObjectControl(e,t){AKIT.control.addObjectControlProximity(e,this,t),this.mesh=t}delObjectControlProximity(){AKIT.control.delObjectControlProximity(this.mesh)}delObject(){AKIT.control.delControlObject(this,this.mesh)}message(){}}class p extends l{constructor(e){super(),this.parent=e,AKIT.alogKitCtl2(" (control3DRayObj-init) "+e)}eventDown(e,t,i,r){return AKIT.alogKitCtl2(" (control3DRayObj-eventDown) "+e+" "+t+" "+i+" "+r),!!this.parent.eventDownCheck(e,r)&&(this.parent.eventDown(e,t,i,r),this.startDownEvent(e,t,r),!0)}eventDrag(e,t,i,r){if(AKIT.alogKitCtl2(" (control3DRayObj-eventDrag) "+e+" "+t+" "+JSON.stringify(i)+" "+this.eventStartDownTime[e]),null!=this.eventStartDownTime[e]){let s=this.eventStillDownPoint[e];AKIT.alogKitCtl2(" (control3DRayObj-eventDrag2) "+e+" "+t+" "+JSON.stringify(s)),this.stillDownEvent(e,t,i.point,i.origin),this.parent.eventDrag(e,t,i,r,s,i.origin)}}eventMove(e,t,i,r,s,o){AKIT.alogKitCtl2(" (control3DRayObj-eventMove) "+e+" "+t+" "+i+" "+r),this.stillOverEvent(e,t,i,r,s,o),this.parent.eventHover(e,t,i,r,s,o)}eventOver(e,t,i,r,s,o){AKIT.alogKitCtl2(" (control3DRayObj-eventOver) "+e+" "+t+" "+i+" "+r),this.stillOverEvent(e,t,i,r,s,o),this.parent.eventOver(e,t,i,r,s,o)}eventOverTimer(e){if(this.stillOverEventTimer(e))return!0}eventOut(e,t,i,r,s){this.stillOverEventEnd(e),this.parent.eventOut(e,t,i,r,s)}eventOutEnd(e){this.stillOverEventEnd(e)}eventUp(e,t,i,r){this.stillDownEventEnd(e,t),this.parent.eventUp(e,t,i,r)}eventDistance(e,t,i){this.parent.eventDistance(e,t,i)}eventDefault(e,t,i){}eventUpSwitch(e,t,i,r){this.clearEvent(e)}eventDownSwitch(e,t,i,r){this.startDownEvent(e,t,r)}}class u extends c{constructor(){super(),this.updated=!1,this.renderOrder=0,this.world=!1,this.propertyObject={},this.ready=!1,this.loader=!1}init(){}add(e){this.world=!0,AKIT.scene.scene.add(this.object)}remove(){this.world=!1,AKIT.scene.scene.remove(this.object)}show(){this.object.visible=!0}hide(){this.object.visible=!1}visible(e){this.setOpacity(e)}store(){this.remove()}retrieve(){}delete(){this.remove()}run(){}step(){}active(e){if(0==this.ready){if(!this.isready())return this.loaderRun();this.ready=!0}if(this.ready&&null!=this.object){if(0==this.isVisible())return this.loaderStop(),this.add(),this.show(),this.run(),this.step(),null!=e&&this.activeOpts(e),console.log("add",this.object,e),!0;this.step()}return!1}activeOpts(e){if(null!=e.point){let t=e.point;this.positionXYZ(t.x,t.y,t.z)}}inactive(e){this.isVisible()&&(this.hide(),this.remove(),this.stop(),console.log("rem",this.object)),this.loaderStop()}isready(){return!0}loaderSet(e){this.loader=!0,this.loaderState=!1,this.loaderName=e}loaderRun(){return!!this.loader&&(this.loaderShow(),AKIT.loader.update(this.loaderName),!0)}loaderStop(){this.loader&&this.loaderHide()}loaderHide(){this.loaderState&&(this.loaderState=!1,AKIT.loader.hide(this.loaderName))}loaderShow(){0==this.loaderState&&(this.loaderState=!0,AKIT.loader.show(this.loaderName))}loaderAdd(){}isVisible(){return this.world}registerController(e){e.addObject(this.object)}control(){this.properties.control=new p(this),this.properties.control.init(),this.properties.control.addObject(this.object)}eventDownCheck(e,t){return!0}eventDown(e,t,i,r,s){console.log("eventDown",t,i,r,s,this.isVisible())}eventOver(e,t,i,r){}eventOut(e,t,i){}eventUp(e,t,i){}eventHover(e,t,i,r){}eventDrag(e,t,i,r,s){}eventTapCheck(){return!0}eventTap(){}position(e){this.object.position.x=e.x,this.object.position.y=e.y,this.object.position.z=e.z}positionXYZ(e,t,i){this.object.position.x=e,this.object.position.y=t,this.object.position.z=i}rotation(e){this.object.rotation=e}rotationXYZ(e,t,i){this.object.rotation.x=e,this.object.rotation.y=t,this.object.rotation.z=i}rotationXYZRadians(e,t,i){this.object.rotation.x=e*Math.PI,this.object.rotation.y=t*Math.PI,this.object.rotation.z=i*Math.PI}getPosition(){return this.object.position}scaleXYZ(e,t,i){this.object.scale.x=e,this.object.scale.y=t,this.object.scale.z=i}meshObject(e,t){this.object=new THREE.Mesh(e,t),AKIT.alogKit("aobj-mesh:"+this.object.id)}meshObjectGeometry(){this.object.geometry=this.child.geometry}meshObjectGeometryUpdate(){this.meshObjectGeometryDelete(),this.object.geometry=this.child.geometry}meshObjectGeometryDelete(){this.object.geometry=null}meshObjectUpdateAll(){const e=this.object.geometry;e.computeFaceNormals(),e.computeVertexNormals(),e.computeBoundingSphere(),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0}meshObjectUpdate(){this.object.geometry.verticesNeedUpdate=!0}meshObjectUpdateBoundary(){this.object.geometry.verticesNeedUpdate=!0,this.object.geometry.computeBoundingSphere()}meshObjectNormalsUpdate(){this.object.geometry.verticesNeedUpdate=!0,this.object.geometry.normalsNeedUpdate=!0}meshRenderOrder(e){}dynamic(){}updateVertices(e){for(let t=0;t<=e;t++){const i=e[t];this.setVertex(t,i.x,i.y,i.z)}}getVertex(e){return this.object.geometry.vertices[e]}setVertex(e,t){this.object.geometry.vertices[e].set(t.x,t.y,t.z)}setVertexXYZ(e,t,i,r){const s=this.object.geometry.vertices[e];s.x=t,s.y=i,s.z=r}updateScale(e){this.object.scale.x=e,this.object.scale.y=e,this.object.scale.z=e}updateScaleXYZ(e,t,i){this.object.scale.x=e,this.object.scale.y=t,this.object.scale.z=i}setOpacity(e){this.object.material.opacity=e}setColorRGB(e,t,i){this.object.material.color.setRGB(e,t,i)}setCustomColorRGB(e,t,i){const r=this.object.material.uniforms.customColor.value;r.r=e,r.g=t,r.b=i}imageTextureUpdate(e){this.object.texture.image=e,this.object.texture.needsUpdate=!0}textureUpdate(){this.object.material.needsUpdate=!0}addChildGeometry(e,t){this.addChild("geometry",t,e)}storeChildGeometry(e){this.storeChild("geometry",e)}restoreChildGeometry(e){return!!this.restoreChildObject(e,"geometry")}restoreChildObject(e,t){this.storeChild(t,e);let i=this.restoreChild(e,t);return null==i||(this.unsetChild(t),this.setChild(t,i,e),!1)}addObjectProperty(e){let t;switch(e){case"visible":t=new d(this)}return this.propertyObject[e]=t,t}}class m extends c{constructor(){super()}setOpacity(e){}materialDebug(){return new THREE.MeshBasicMaterial({side:THREE.DoubleSide,wireframe:!0})}addMaterial(e){this.properties.debug?this.properties.material=this.materialDebug():this.properties.material=e}getMaterial(){return this.properties.material}setTexture(){}}class v extends m{constructor(){super(),this.material()}material(){this.properties.material=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!0})}}class g extends u{constructor(e,t,i){super(),this.radius=e,this.widthSegments=t,this.heightSegments=i,this.id_geometry="sphere_"+this.radius+"_"+this.widthSegments+"_"+this.heightSegments,this.setType("debugObject","debugObject"),this.geometry(),this.material(),this.meshObject(this.child.geometry,this.child.material.properties.material)}store(){this.storeChildGeometry(this.id_geometry),this.remove()}restore(){}geometry(){this.restoreChildGeometry(this.id_geometry)&&(this.addChildGeometry(this.id_geometry,new THREE.SphereGeometry(this.radius,this.widthSegments,this.heightSegments)),this.child.geometry.computeBoundingSphere())}material(){this.addChild("material",new v)}}class A extends m{constructor(e,t){super(),this.properties.transparent=!1,null!=t&&(this.properties.transparent=t),this.material(e)}material(e){this.properties.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:this.properties.transparent,map:e,color:16777215,depthTest:!1})}}class P extends c{constructor(){super()}update(e){this.properties.texture.image=e,this.properties.texture.needsUpdate=!0}}class T extends P{constructor(e,t){super(),this.properties.parent=e,this.loader(t)}loader(e){let t=new THREE.TextureLoader,i=this;t.load(e,function(e){i.texture(e)},function(e){console.log(e)},function(e){})}texture(e){e.generateMipmaps=!0,e.magFilter=THREE.LinearFilter,e.minFilter=THREE.LinearFilter,this.properties.textureAnimator=new b(e,30,1,30,50),this.properties.texture=e,this.properties.parent.loaded()}update(){var e=AKIT.clock.getDelta();this.properties.textureAnimator.update(1e3*e)}}function b(e,t,i,r,s){this.tilesHorizontal=t,this.tilesVertical=i,this.numberOfTiles=r,e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(1/this.tilesHorizontal,1/this.tilesVertical),this.tileDisplayDuration=s,this.currentDisplayTime=0,this.currentTile=0,this.update=function(t){for(this.currentDisplayTime+=t;this.currentDisplayTime>this.tileDisplayDuration;){this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile==this.numberOfTiles&&(this.currentTile=0);var i=this.currentTile%this.tilesHorizontal;e.offset.x=i/this.tilesHorizontal;var r=Math.floor(this.currentTile/this.tilesHorizontal);e.offset.y=r/this.tilesVertical}}}class f extends u{constructor(e,t,i,r,s,o){super(),this.properties.image=e,this.properties.planeX=t,this.properties.planeY=i,this.properties.scale=1,this.properties.imageHeight=s,this.properties.imageWidth=r,this.properties.debug=o,this.setType("planeSpinner","planeSpinner-"+t+"_"+i),this.properties.size=t*i,this.properties.rotation=0}init(){this.geometry(),this.texture()}loaded(){this.material(),this.mesh(),this.setOpacity(.7),AKIT.loader.ready("spinner")}texture(){const e=new T(this,this.properties.image);this.addChild("texture",e)}material(){this.properties.debug?this.addChild("material",new v):this.addChild("material",new A(this.child.texture.properties.texture,!0))}geometry(){this.properties.geometry=new THREE.PlaneBufferGeometry(this.properties.imageWidth,this.properties.imageHeight,this.properties.planeX,this.properties.planeY)}mesh(){this.meshObject(this.properties.geometry,this.child.material.properties.material),this.meshObjectUpdateAll()}update(){null!=this.child.texture&&this.child.texture.update()}}class y{constructor(){this.loaders={},this.loadersArgs={}}add(e,t){let i,r=!1;if("test"==e){let e=t.size;i=new g(e,e,e),r=!0}if("spinner"==e){let e=t.size;i=new f("assets/img/spinner.png",e,e,t.len,t.len,!1)}i.init(),this.loaders[e]=i,this.loadersArgs[e]=t,r&&this.ready(e)}ready(e){let t=this.loaders[e],i=this.loadersArgs[e];this.argumentsSet(t,i),AKIT.alogKit("(loader-add): "+e+" "+i)}show(e){let t=this.loaders[e];t.add(),t.show()}hide(e){let t=this.loaders[e];t.hide(),t.remove()}update(e){this.loaders[e].update()}argumentsSet(e,t){let i=t.rotate;null!=i&&e.rotationXYZ(i.x*Math.PI,i.y*Math.PI,i.z*Math.PI)}}class R extends u{constructor(){super()}activeSet(e){return!!this.active(e)&&(this.setFocusObject(),!0)}activeUnset(e){this.inactive(e)}settings(e){this.properties.settings=e}set(){var e=this.properties.settings;let t=e.scale;this.updateScale(t);let i=e.rotate;null!=i&&this.rotationXYZ(i.x*Math.PI,i.y*Math.PI,i.z*Math.PI)}run(){"video"==this.properties.artype&&this.runVideo()}stop(){"video"==this.properties.artype&&this.stopVideo()}step(){"video"==this.properties.artype&&this.stepVideo()}setFocusObject(){"video"==this.properties.artype?APP.run.app.setFocusAction("autoplay",this):APP.run.app.clearFocusAction()}}class E extends P{constructor(e){super(),this.texture(e)}texture(e){const t=new THREE.Texture(e);t.generateMipmaps=!1,t.magFilter=THREE.LinearFilter,t.minFilter=THREE.LinearFilter,t.needsUpdate=!0,this.properties.texture=t}}class S extends m{constructor(e,t,i){super(),this.type="materialShader",this.properties.fragmentShaderUniform=e,this.properties.fragmentShader=t,this.properties.blending=i,this.material()}material(){var e=this.properties.fragmentShaderUniform,t=this.properties.fragmentShader,i=this.properties.blending;return this.materialFragmentShader(e,t,i)}materialFragmentShader(e,t,i){return null==i&&(i=THREE.NormalBlending),this.materialFragmentShaderBase(e,t,THREE.DoubleSide,i)}materialFragmentShaderBase(e,t,i,r){const s=e,o=t.vertex,a=t.fragment,n=new THREE.ShaderMaterial({uniforms:s,vertexShader:o,fragmentShader:a,side:i,blending:r,transparent:!0,opacity:.1,alphaTest:.1,depthTest:!1});this.properties.material=n}uniformUpdatePosition(e,t,i){this.properties.material.uniforms.uPosition.value[0]=e,this.properties.material.uniforms.uPosition.value[1]=t,this.properties.material.uniforms.uPosition.value[2]=i}uniformUpdateRotation(e,t,i){this.properties.material.uniforms.uRotation.value[0]=e,this.properties.material.uniforms.uRotation.value[1]=t,this.properties.material.uniforms.uRotation.value[2]=i}uniformUpdateScale(e,t){this.properties.material.uniforms.uScale.value[e]=t}uniformUpdatePath(e,t,i,r){this.properties.material.uniforms.uPath.value[e].x=t,this.properties.material.uniforms.uPath.value[e].y=i,this.properties.material.uniforms.uPath.value[e].z=r}uniformUpdatePathLength(e){this.properties.material.uniforms.uPathLength.value=e}uniformUpdateDuration(e){this.properties.material.uniforms.uDuration.value=e}uniformUpdateColor(e,t,i){this.properties.material.uniforms.uColor.value.r=e,this.properties.material.uniforms.uColor.value.g=t,this.properties.material.uniforms.uColor.value.b=i}}class I{constructor(e){this.properties={},this.init(e)}init(e){this.properties.color=16777215,this.properties.fragmentShaderUniform=this.uniform(e),this.properties.fragmentShader=this.fragmentShader()}uniform(e){return{uTexture:{type:"t",value:e},customValue:{type:"f",value:.5}}}fragmentShader(){return{vertex:["varying vec2 vTexCoord;","void main(void) {","vTexCoord = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}\n"].join("\n"),fragment:["uniform sampler2D uTexture;","uniform vec2 resolution;","varying vec2 vTexCoord;","void main(void) {","vec4 texColor = texture2D(uTexture, vTexCoord);","float aspect = 3.0/3.0;","float scale = .9;","float offset = 0.0;","float smoothingX = -0.4;","float smoothingY = 0.8;","vec2 pos = vTexCoord;","pos -= 0.5;","pos.x *= aspect;","pos /= scale;","pos -= offset;","float dist = length(pos);","dist = smoothstep(smoothingX, smoothingY, 1.-dist);"," vec3 color2 = vec3(0.0,0.0,0.0);","vec3 color = mix(color2, texColor.rgb, dist);","float threshold;","float clipBlack=0.9;","float clipWhite=0.9;","const vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);","float luma = dot(color,lumcoeff);","float alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);","gl_FragColor = vec4(color, min(1.0, alpha) );","}"].join("\n")}}}class j extends c{constructor(e){super(),this.init(e)}init(e){this.texture(e),this.shader(),this.material()}getMaterial(){return this.child.material.properties.material}setTexture(e){this.child.texture.update(e)}texture(e){this.addChild("texture",new E(e))}shader(){this.addChild("shader",new I(this.child.texture.properties.texture))}material(){const e=this.child.shader.properties.fragmentShaderUniform,t=this.child.shader.properties.fragmentShader;this.addChild("material",new S(e,t))}}class D extends c{constructor(e,t,i,r){super(),this.properties.videoSrc=e,this.properties.posterSrc=t,this.properties.imageWidth=i,this.properties.imageHeight=r,this.properties.videoProps={},this.properties.videoProps.duration=0}startVideo(){this.cueVideo(0)}cueVideo(e){const t=e/1e3;this.videoTime(t),this.videoCue()}stopVideo(){this.videoStop()}resetVideoTime(){this.videoTime(0),this.videoHalt()}setVideoTime(e){const t=e/1e3;this.videoTime(t),this.videoHalt()}isVideoPlaying(){return this.properties.videoPlaying}getVideoCurrentTime(){return 1e3*this.videoTimeGet()}getVideoTime(){if(1==this.properties.videoMetaReady){return this.getVideoDuration()}return 0}getVideoDuration(){return 1e3*this.properties.videoProps.duration}getSeekTime(e,t){let i,r=-1;return 1==this.properties.videoMetaReady?(r=(i=this.getVideoDuration())<e?0:(i-e)*t,AKIT.aloggerKitV("avideo: (getSeekTime):"+r+" "+i+" "+t)):AKIT.aloggerKitV("avideo: (getSeekTime-fail):"+this.properties.videoMetaReady),r}videoInit(){this.properties.videoReady=!1,this.properties.videoMetaReady=!1,this.properties.videoPlaying=!1,this.properties.videoUpdated=!1,this.properties.video=document.createElement("video"),this.videoProperties(),this.properties.video.src=this.properties.videoSrc,this.properties.video.width=this.properties.imageWidth,this.properties.video.height=this.properties.imageHeight,AKIT.aloggerKitV("avideo: (init):"+this.properties.videoSrc+" "+this.properties.video.width+" "+this.properties.video.height)}videoClone(e,t){this.properties.videoReady=!0,this.properties.videoMetaReady=!0,this.properties.videoPlaying=!1,this.properties.videoUpdated=!1,this.properties.video=e,this.videoProperties(),this.properties.video.width=this.properties.imageWidth,this.properties.video.height=this.properties.imageHeight,this.properties.videoProps.duration=t}videoProperties(){this.properties.video.setAttribute("playsInline","playsinline"),this.properties.video.setAttribute("controls",!1)}videoURLReady(){this.videoEvents(),this.videoLoad(),AKIT.aloggerKitV("(aobj-videoObj-init):"+vname+" "+vsrc+" "+w+" "+h)}videoReinit(e,t){this.properties.videoSrc=e,this.properties.videoReady=!1,this.properties.videoMetaReady=!1,this.properties.videoPlaying=!1,this.properties.videoUpdated=!1,this.properties.video.src=this.properties.videoSrc,AKIT.aloggerKitV("avideo: (init-re):"+this.properties.videoSrc)}videoReset(){this.properties.videoReady=!1,this.properties.videoMetaReady=!1,this.properties.videoPlaying=!1,null==this.properties.video&&(this.properties.video=document.createElement("video")),this.properties.video.removeEventListener("loadedmetadata"),this.properties.video.removeEventListener("loadeddata"),this.properties.video.removeEventListener("durationchange"),this.properties.video.removeEventListener("error")}videoEvents(){this.properties.videoProps.src=this.properties.videoSrc,this.videoLoadEvents(),this.videoErrorEvents(),AKIT.aloggerKitV("(aobj-videoObj-events-set) "+this.properties.video)}videoLoadEvents(){const e=this;this.properties.video.addEventListener("loadedmetadata",function(t){e.properties.videoProps.duration=this.duration,AKIT.aloggerKitV("(aobj-videoObj-loaded meta) "+e.properties.video.id+" "+this.duration),e.properties.videoMetaReady=!0,e.videoUpdated()}),this.properties.video.addEventListener("loadeddata",function(){AKIT.aloggerKitV("(aobj-videoObj-loaded data) "+e.properties.video.id),e.properties.videoReady=!0,e.videoUpdated()}),this.properties.video.addEventListener("durationchange",function(){e.properties.videoProps.duration=this.duration,AKIT.aloggerKitV("(aobj-videoObj-duration) "+e.properties.video.id+"  new:"+this.duration+"  old:"+e.properties.videoProps.duration),e.properties.videoMetaReady=!0})}videoErrorEvents(){const e=this;this.properties.video.addEventListener("error",function(t){switch(e.properties.videoReady=-1,t.target.error.code){case t.target.error.MEDIA_ERR_ABORTED:AKIT.akitError("You aborted the media.video playback.",e.properties.videoProps);break;case t.target.error.MEDIA_ERR_NETWORK:AKIT.akitError("A node.network error caused the media.video download to fail part-way.",e.properties.videoProps);break;case t.target.error.MEDIA_ERR_DECODE:AKIT.akitError("The media.video playback was aborted due to a corruption problem or because the media.video used features your browser did not support.",e.properties.videoProps);break;case t.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:AKIT.akitError("The media.video could not be loaded, either because the server or node.network failed or because the format is not supported.",e.properties.videoProps);break;case t.target.error.ERR_CACHE_READ_FAILURE:AKIT.akitError("Cannot read the cache.",e.properties.videoProps);break;default:AKIT.akitError("An unknown error occurred."+t.target.error.code)}})}videoLoopEvents(){const e=this;this.properties.video.addEventListener("ended",function(){e.videoEnd()})}videoUpdatedCheck(){return!!this.properties.videoUpdated&&(this.properties.videoUpdated=!1,!0)}videoUpdated(){0==this.properties.videoUpdated&&1==this.properties.videoReady&&1==this.properties.videoMetaReady&&(this.properties.videoUpdated=!0)}videoReload(){this.videoLoad(),AKIT.aloggerKitV("(aobj-videoObj-reload):"+this.properties.video.id+" "+this.properties.video.duration)}videoLoad(){this.properties.video.load(),AKIT.aloggerKitV("(aobj-videoObj-load) "+this.properties.video.id)}videoCue(){1==this.properties.videoReady&&1==this.properties.videoMetaReady&&0==this.properties.videoPlaying&&("edge"!=AKIT.env.browser?this.properties.video.play().catch(function(e){AKIT.aloggerKitV("(aobj-videoObj-error-play) "+this.properties.video.id+" "+e)}):this.properties.video.play(),AKIT.aloggerKitV("(aobj-videoObj-play) "+this.properties.video.id),this.properties.videoPlaying=!0)}videoPlay(){0==this.properties.videoPlaying&&(this.properties.video.play(),AKIT.aloggerKitV("(aobj-videoObj-play) "+this.properties.video.id+" "+this.properties.videoPlaying+"  "+this.properties.videoReady),this.properties.videoPlaying=!0)}videoHalt(){this.properties.video.pause(),this.properties.videoPlaying=!1}videoStop(){1==this.properties.videoPlaying&&(this.videoHalt(),AKIT.aloggerKitV("(aobj-videoObj-stop) "+this.properties.video.id))}videoTime(e){1==this.properties.videoReady&&1==this.properties.videoMetaReady&&this.properties.video.readyState===this.properties.video.HAVE_ENOUGH_DATA&&(AKIT.aloggerKitV("(aobj-videoObj-time) "+this.properties.video.id+" "+e),this.properties.video.currentTime=e)}videoMute(e){this.properties.video.muted=e}videoTouchToPlay(){const e=this;this.properties.video.addEventListener("touchend",function(t){1==e.properties.videoReady&&1==e.properties.videoMetaReady&&0==e.properties.videoPlaying&&(e.properties.video.play(),console.log("play"))})}videoHasEnoughData(){return this.properties.video.readyState===this.properties.video.HAVE_ENOUGH_DATA}videoUpdate(){1==this.properties.videoReady&&1==this.properties.videoMetaReady&&this.properties.video.readyState===this.properties.video.HAVE_ENOUGH_DATA&&this.properties.context.drawImage(this.properties.video,0,0)}videoTimeGet(){return 1==this.properties.videoReady&&1==this.properties.videoMetaReady&&this.properties.video.readyState===this.properties.video.HAVE_ENOUGH_DATA?(AKIT.aloggerKitV("(aobj-videoObj-time) "+this.properties.video.id+" "),this.properties.video.currentTime):0}videoClose(){this.properties.videoReady=!1,this.properties.videoMetaReady=!1,this.properties.videoPlaying=!1,this.proerties.textureImgLoaded=!1,AKIT.aloggerKitV("(aobj-videoObj-close) "+this.properties.video.id),this.properties.video.id=-1,this.properties.video.src=""}videoEnd(){this.properties.videoProps.loop&&this.cueVideo(0)}setVideoProperty(e,t){this.properties.videoProps[e]=t}getVideoProperty(e,t){}}class x extends D{constructor(e,t,i,r){super(),this.properties.videoSrc=e,this.properties.posterSrc=t,this.properties.imageWidth=i,this.properties.imageHeight=r,AKIT.video.registerVideo(e,i,r),this.properties.imageLoaded=!1,this.properties.videoLoaded=!1,this.init()}init(){}reinit(e){this.properties.videoSrc=e,AKIT.video.registerVideo(e,this.properties.imageWidth,this.properties.imageHeight),this.properties.imageLoaded=!1,this.properties.videoLoaded=!1}check(){return!(this.properties.videoLoaded||!AKIT.video.checkVideo(this.properties.videoSrc))&&(this.properties.videoLoaded=!0,this.video(),!0)}checkImageReady(){return this.properties.videoLoaded}video(){var e=AKIT.video.getVideo(this.properties.videoSrc),t=e.video,i=e.videoProps.duration;this.videoClone(t,i)}getVideoDuration(){return this.properties.videoLoaded?super.getVideoDuration():0}resetVideoTime(){this.properties.videoLoaded&&super.resetVideoTime()}cueVideo(e){this.properties.videoLoaded&&super.cueVideo(e)}getVideoCurrentTime(){return this.properties.videoLoaded?super.getVideoCurrentTime():1}}class k extends R{constructor(e,t,i,r,s,o,a){super(),this.properties.planeX=e,this.properties.planeY=t,this.properties.scale=.1,this.properties.imageHeight=r,this.properties.imageWidth=i,this.properties.hostName=s,this.properties.videoSrc=o,this.properties.debug=a,this.properties.artype="video",this.setType("planeVideo","planeVideo-"+e+"_"+t)}init(){null==this.properties.video?(this.video(),this.material(),this.geometry(),this.mesh(),this.meshObjectUpdateAll()):this.reinit()}reconstruct(e,t,i,r,s,o,a){this.properties.planeX=e,this.properties.planeY=t,this.properties.scale=.1,this.properties.imageHeight=r,this.properties.imageWidth=i,this.properties.hostName=s,this.properties.videoSrc=o}reinit(){this.properties.video.reinit(this.properties.videoSrc)}video(){const e=this.properties.videoSrc;let t=this.properties.imageWidth,i=this.properties.imageHeight;this.properties.video=new x(e,"",t,i)}material(){if(this.properties.debug)this.addChild("material",new v);else{this.addChild("material",new j(void 0))}}geometry(){this.properties.geometry=new THREE.PlaneBufferGeometry(this.properties.planeX,this.properties.planeY,this.properties.imageWidth,this.properties.imageHeight)}mesh(){this.meshObject(this.properties.geometry,this.child.material.getMaterial()),this.properties.geometry.dynamic=!0}isready(){return this.loadVideo(),!!this.checkVideo()}checkVideo(){return!(null==this.properties.video||!this.properties.video.check())&&(this.setVideoMaterial(),this.textureUpdate(),this.meshObjectUpdateAll(),this.set(),this.properties.video.startVideo(),!0)}setVideoMaterial(){this.child.material.setTexture(this.properties.video.properties.video)}loadVideo(){if(null!=this.properties.video&&this.properties.video.checkImageReady())return this.setVideoMaterial(),!0}stepVideo(){this.setVideoMaterial()}runVideo(){this.properties.video.videoTime(0),this.properties.video.videoCue(0),AKIT.video.focus=this.properties.video}clickVideo(){this.properties.video.videoTime(0),this.properties.video.videoCue(0)}stopVideo(){this.properties.video.videoStop()}reinitVideo(e){this.video.reloader(e),this.video.videoReinit(e)}eventUp(e,t,i){}eventDown(e,t,i,r,s){this.clickVideo()}}class K{constructor(){}getType(e){var t=AKIT.store.restoreObject(e);if(null!=t)return AKIT.alogPreload("(restore) "+e+" "),t}preload(){for(let e in APP.preload)this.preloadType(e)}preloadType(e){let t=this.preloadData(e);this.preloadTypeNo(t.number,e,t.args)}preloadData(e){return APP.preload[e]}preloadTypeNo(e,t,i){for(let r=0;r<e;r++){let e=this.preloadTypeModule(t,i);AKIT.store.storeObject(t,e),AKIT.alogPreload("(store) "+r+" "+t+" "+e)}}preloadTypeModule(e,t){let i;switch(e){case"ARTypePlaneVideoEffectVignette":i=new k(t[0],t[1],t[2],t[3],t[4],t[5],t[6]);break;case"ARTypeFile":i=new AKIT_ObjectARTypeFile(t[0],t[1])}return i}}class C{constructor(){this.store={},this.preloader=new K}storeObject(e,t){null==this.store[e]&&(this.store[e]=[]),this.store[e].push(t)}restoreObject(e){if(null!=this.store[e]){let t=this.store[e];if(t.length>0){let e=t[0];return t.remove(0),e}}}get(e){return this.preloader.getType(e)}}class O{constructor(){AKIT.initObjectStore=function(){AKIT.store=new C,AKIT.store.preloader.preload()},Array.prototype.storeIndex=function(e){this[e].store();const t=this.slice(e+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,t)}}}class M{constructor(e,t){this.parent=e,this.id=e.id,this.init(t)}init(e){this.URL=e,this.URLp="",this.URLready=!1,this.URLMediaready=!1,this.URLTimeout=4e3,this.URLTimeoutCount=0,this.URLTimer=Date.now()}checkURLReady(){0==this.URLready?0!=this.URLTimer&&null!=this.URL&&""!=this.URL&&1==this.checkURLTimeout()&&this.checkURL():0==this.URLMediaready&&0!=this.URLTimer&&null!=this.URL&&""!=this.URL&&1==this.checkURLTimeout()&&this.checkMediaURL()}checkURL(){AKIT.aloggerKitURL("anode: (media.agent-checkurl):"+this.id+" "+this.URL),this.URLTimer=0,this.fileExistsCall(this.URL,this,this.fileExistsCallback)}checkURLCallback(e){1==e?(AKIT.aloggerKitURL("anode: (media.agent-checkurl-call-ok):"+this.id+" "+this.URL),this.setURL()):(AKIT.aloggerKitURL("anode: (media.agent-checkurl-call-timeout):"+this.id+" "+this.URL),this.setURLTimeout())}checkURL2(){AKIT.aloggerKitURL("anode: (media.agent-checkurl):"+this.id+" "+this.URL);const e=this;this.fileExists(this.URL)?e.setURL():e.setURLTimeout()}setURL(){AKIT.aloggerKitURL("anode: (media.agent-set):"+this.id+" "+this.URL),""==this.URL&&AKIT.aloggerKitURL("anode: (media.agent-set-null):"+this.id+" "+this.URL),0==this.URLready&&(this.URLready=!0,this.parent.setURLMedia(),this.URLTimeoutCount=0,this.URLTimer=Date.now())}checkMediaURL(){AKIT.aloggerKitURL("anode: (media.agent-checkmedia):"+this.id+" "+this.URL);const e=this;this.parent.checkURLMedia(this.URL,this.URLp)?e.startURL():e.setURLTimeout()}startURL(){AKIT.aloggerKitURL("anode: (media.agent-startmedia):"+this.id+" "+this.URL),0==this.URLMediaready&&(this.URLMediaready=!0,this.parent.startURLMedia())}setURLTimeout(){this.URLTimeoutCount++,this.URLTimer=Date.now(),AKIT.aloggerKitURL("anode: (media.agent-timer):"+this.id+" "+this.URLTimeoutCount),this.URLTimeoutCount>3&&(this.URLTimeoutCount=0,this.URLTimer=0,this.parent.failURLMedia())}checkURLTimeout(){const e=Date.now()-this.URLTimer;return e>this.URLTimeout&&(this.URLTimer=0,AKIT.aloggerKitURL("anode: (media.agent-timeout):"+this.id+" "+e),!0)}fileExistsCall(e,t,i){if(""==e)i(!1,t);else{var r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&(AKIT.aloggerKitURL("autil: (exists-call):"+e+"  "+r.readyState+" "+r.status),200==r.status||206==r.status?i(!0,t):i(!1,t))},r.open("GET",e,!0),r.send(null)}AKIT.aloggerKitURL("autil: (exists):"+e+" "+r.status)}fileExistsCallback(e,t){AKIT.aloggerKitURL("autil: (exists-callback):"+t+" "+e),t.checkURLCallback(e)}fileExists(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(null),AKIT.aloggerKitURL("autil: (exists-test):"+e+" "+t.status),404==t.status?(AKIT.aloggerKitURL("autil: (exists-nup):"+e+"  "+t.readyState+" "+t.status),!1):(AKIT.aloggerKitURL("autil: (exists-yep):"+e+"  "+t.readyState+" "+t.status),!0)}}class L extends D{constructor(e,t,i,r){super(e,t,i,r),this.properties.videoSrc=e,this.loader()}loader(){const e=new M(this,this.properties.videoSrc);this.addChild("loader",e)}reloader(e){this.properties.videoSrc=e,this.child.loader.init(e)}checkVideoURLReady(){if(this.videoUpdatedCheck())return!0;this.child.loader.checkURLReady()}updateVideoTimeout(){-1==this.properties.video.videoReady&&this.properties.video.videoReload()}}class U extends L{constructor(e,t,i,r,s){super(e,t,i,r),this.properties.videoSrc=e,this.properties.videoImg=t,this.properties.lengthWidth=i,this.properties.lengthHeight=r,this.videoInit()}check(){return!!this.checkVideoURLReady()&&(this.setVideoReady(),!0)}setVideoReady(){AKIT.video.setLoadNotify(this.properties.videoSrc)}setVideoLoad(){this.videoEvents(),this.videoLoad()}setURLMedia(){AKIT.video.addLoadQueue(this.properties.videoSrc)}checkURLMedia(){return!0}startURLMedia(){}failURLMedia(){}getRenderId(){}}const V=0,H=e=>(e+1>>>1)-1,W=e=>1+(e<<1),G=e=>e+1<<1;class N{constructor(e=((e,t)=>e>t)){this._heap=[],this._comparator=e}size(){return this._heap.length}isEmpty(){return 0==this.size()}isActive(){return this.size()>0}peek(){return this._heap[V]}push(...e){return e.forEach(e=>{this._heap.push(e),this._siftUp()}),this.size()}pop(){const e=this.peek(),t=this.size()-1;return t>V&&this._swap(V,t),this._heap.pop(),this._siftDown(),e}replace(e){const t=this.peek();return this._heap[V]=e,this._siftDown(),t}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){[this._heap[e],this._heap[t]]=[this._heap[t],this._heap[e]]}_siftUp(){let e=this.size()-1;for(;e>V&&this._greater(e,H(e));)this._swap(e,H(e)),e=H(e)}_siftDown(){let e=V;for(;W(e)<this.size()&&this._greater(W(e),e)||G(e)<this.size()&&this._greater(G(e),e);){let t=G(e)<this.size()&&this._greater(G(e),W(e))?G(e):W(e);this._swap(e,t),e=t}}}class z{constructor(){this.videoList={},this.videoPairwiseQueue=new N((e,t)=>e[1]>t[1]),this.videoLoadList=[],this.numberOfLoads=1,this.focus=0}cycle(){this.updateLoadQueue()}registerVideo(e,t,i){null==this.videoList[e]&&(this.videoList[e]=new U(e,"",t,i))}checkVideo(e){return!!this.videoList[e].check()}getVideo(e){return this.videoList[e].properties}addLoadQueue(e){var t=Date.now();this.videoList[e].priority=t,this.videoPairwiseQueue.push([e,-t])}updateLoadQueue(){this.videoLoadList.length<this.numberOfLoads&&this.videoPairwiseQueue.isActive()&&this.addLoadingList(this.videoPairwiseQueue.pop()[0])}setLoadNotify(e){this.delLoadingList(e)}addLoadingList(e){null==this.videoLoadList[e]&&(this.videoLoadList.push(e),this.videoList[e].setVideoLoad(e))}delLoadingList(e){let t=this.videoLoadList.indexOf(e);this.videoLoadList.remove(t)}setVideoFocus(){}}class F extends c{constructor(e,t,i){super(),this.id_geometry="objFile_"+t+"_"+e,this.setType("objectFile","objectFile"),this.properties.name=e,this.properties.path=t,this.properties.scale=i}init(){this.loader(this.properties.name,this.properties.path)}promise(){let e=this;var t=this.properties.name+".obj",i=this.properties.name+".mtl",r=this.properties.path;let s=new Promise(s=>{var o=new THREE.MTLLoader;o.setTexturePath(r),o.setPath(r),o.load(i,function(i){i.preload();var o=new THREE.OBJLoader;o.setMaterials(i),o.setPath(r),o.load(t,function(t){e.loaded(t),s(t)})})});this.promiseSet(s)}promiseSet(e){let t=[];e.then(function(e){return e}),t.push(e),Promise.all(t).then(e=>{})}loader(e,t){let i=this;var r=e+".obj",s=e+".mtl";console.log("load",r,s,t);var o=new THREE.MTLLoader;o.setResourcePath(t),o.setPath(t),o.load(s,function(e){e.preload();var s=new THREE.OBJLoader;s.setMaterials(e),s.setPath(t),s.load(r,function(e){i.loaded(e)})})}loaded(e){this.call("loaded",e)}}class B extends c{constructor(e,t,i){super(),this.id_geometry="gltfFile_"+t+"_"+e,this.setType("gltfFile","gltfFile"),this.properties.name=e,this.properties.path=t,this.properties.scale=i}promise(){this.init()}init(){this.loader(this.properties.name,this.properties.path)}loader(e,t){let i=this;var r=t+e+".gltf";console.log("load",r,t),(new THREE.GLTFLoader).load(r,function(e){e.scene.traverse(function(e){e.isMesh&&i.loaded(e)})})}loaded(e){console.log(e),this.call("loaded",e)}}class X extends R{constructor(e,t,i,r,s,o){super(),this.properties.data=o,this.properties.type=e,this.properties.name=t,this.properties.filename=i,this.properties.dir=r,this.properties.artype="obj",this.properties.scale=s}init(){this.type(),this.properties.object.promise()}type(){"obj"==this.properties.type?this.typeObj(this.properties.name,this.properties.filename,this.properties.dir):"gltf"==this.properties.type&&this.typeGLTF(this.properties.name,this.properties.filename,this.properties.dir)}typeObj(e,t,i,r){this.properties.object=new F(e,i),this.properties.object.caller(this)}typeGLTF(e,t,i,r){this.properties.object=new B(e,i),this.properties.object.caller(this)}call(e,t){this.object=t,this.set()}}class Y{constructor(e){this.properties={},this.init(e)}init(e){this.properties.color=16777215,this.properties.fragmentShaderUniform=this.uniform(e),this.properties.fragmentShader=this.fragmentShader()}uniform(e){return{uTexture:{type:"t",value:e},uColor:{type:"c",value:new THREE.Color(this.properties.color)},customValue:{type:"f",value:.5}}}fragmentShader(){return{vertex:["varying vec2 vTexCoord;","void main(void) {","vTexCoord = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}\n"].join("\n"),fragment:["uniform sampler2D uTexture;","uniform vec3 uColor;","uniform vec2 resolution;","varying vec2 vTexCoord;","void main(void) {","vec4 texColor = texture2D(uTexture, vTexCoord);","float gray = dot(texColor.rgb, vec3(0.299, 0.587, 0.114));","vec3 imgColor = vec3(gray) * uColor;","texColor.rgb = mix(texColor.rgb, imgColor, 0.9);","float aspect = 3.0/3.0;","float scale = 0.6;","float offset = 0.0;","float smoothingX = -0.4;","float smoothingY = 0.8;","vec2 pos = vTexCoord;","pos -= 0.5;","pos.x *= aspect;","pos /= scale;","pos -= offset;","float dist = length(pos);","dist = smoothstep(smoothingX, smoothingY, 1.-dist);"," vec3 color2 = vec3(0.0,0.0,0.0);","vec3 color = mix(color2, texColor.rgb, dist);","float threshold;","float clipBlack=0.4;","float clipWhite=0.1;","const vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);","float luma = dot(color,lumcoeff);","float alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);","gl_FragColor = vec4(color, min(1.0, alpha) );","}"].join("\n")}}}class Z extends c{constructor(e){super(),this.init(e)}init(e){this.texture(e),this.shader(),this.material()}getMaterial(){return this.child.material.properties.material}setTexture(e){this.child.texture.update(e)}texture(e){this.addChild("texture",new E(e))}shader(){this.addChild("shader",new Y(this.child.texture.properties.texture))}material(){const e=this.child.shader.properties.fragmentShaderUniform,t=this.child.shader.properties.fragmentShader;this.addChild("material",new S(e,t))}}class J extends u{constructor(e,t,i,r,s,o,a){super(),this.properties.planeX=e,this.properties.planeY=t,this.properties.scale=1,this.properties.imageHeight=r,this.properties.imageWidth=i,this.properties.hostName=s,this.properties.videoSrc=o,this.properties.debug=a,this.setType("planeVideo","planeVideo-"+e+"_"+t),this.init()}init(){this.video(),this.material(),this.geometry(),this.mesh()}video(){const e=new AKIT_ObjectVideoEffectURL(this.properties.videoSrc,"",this.properties.imageWidth,this.properties.imageHeight);this.addChild("video",e)}material(){this.properties.debug?this.addChild("material",new v):this.addChild("material",new Z(this.video.properties.canvas))}geometry(){this.properties.geometry=new THREE.PlaneBufferGeometry(this.properties.imageWidth,this.properties.imageHeight,this.properties.planeX,this.properties.planeY)}mesh(){this.meshObject(this.properties.geometry,this.child.material.properties.material),this.properties.geometry.dynamic=!0,this.meshObjectUpdateAll()}playVideo(){this.child.video.setMediaCurrentTime(0)}stopVideo(){this.child.video.resetMediaCurrentTime()}updateVideo(){}initVideo(){const e=this.getVideoSrc(),t=this.getPosterSrc();let i=ANET.clothMediaLengthW,r=ANET.clothMediaLengthH;this.video=new AKIT_ObjectVideoGroup(e,t,i,r),this.initVideoMaterial()}initVideoMaterial(e){this.mediaInsideX,this.mediaInsideY;this.material=new Z(this.video.properties.canvas)}setVideoMaterial(){this.material.setTexture(this.video.properties.video)}loadVideo(){}reinitVideo(e){this.video.reloader(e),this.video.videoReinit(e)}getVideoSrc(){return"http://"+this.properties.host+"/"+this.properties.filename+".webm"}getPosterSrc(){return"http://"+this.properties.host+"/"+this.properties.filename+".png"}}class Q extends u{constructor(e,t,i,r,s,o){super(),this.properties.planeX=e,this.properties.planeY=t,this.properties.scale=1,this.properties.imageHeight=r,this.properties.imageWidth=i,this.properties.videoSrc=s,this.properties.debug=o}init(){this.video()}video(){this.properties.video=new J(this.properties.planeX,this.properties.planeY,this.properties.scale,this.properties.imageHeight,this.properties.imageWidth,this.properties.videoSrc,this.properties.debug)}call(e,t){this.object=t.children[0],this.updateScale(this.properties.scale)}}class q extends R{constructor(e,t){super(),this.properties.name=e,this.object=t}init(e){}}class ${constructor(e){this.parent=e,this.loaderObjID=[],this.groupSelect=-1}init(){this.objects=[],this.objectsData=[],this.objectsGroup={},this.objectsGroupId={},this.objectsLoaded=[]}log(){}load(e){for(let t=0;t<e.length;t++){let i=e[t],r=this.objectLoad(i);this.objectsLoaded.push(r.id)}}loadObj(e){let t=this.objectLoad(e);this.objectsLoaded.push(t.id)}loadAnchor(e){let t=this.objectLoad(e);this.objectsLoaded.push(t.id)}objectsLoad(e){return-1==this.loaderObjID.indexOf(e)&&(this.loaderObjID.push(e),!0)}objectsLoadAgain(e){let t=this.loaderObjID.indexOf(e);this.loaderObjID.remove(t)}objectLoadSet(e){var t=this.objectsLoaded.indexOf(e.id);-1!=t&&(this.objectsLoaded.remove(t),e.init())}objectLoad(e){let t,i,r,s=this.objectProfile(e.filetype);null!=s?("file"==s.location&&(t=this.objectFileURL(e.name,e.dir,e.group,e.filetype)),r=this.objectFileName(e.name,e.filetype,s.extension),i=this.objectType(e,s,r,t),this.objectProperties(i,s)):(r="",e.filetype="",i=this.objectTypeObject(e)),this.objects.push(i);let o=this.objects.length-1,a=this.objectLoadGroupId(e.marker);this.objectGroupAdd(e.group,a,o);let n=this.objectData(e);return this.objectsData.push(n),AKIT.alogAppA("(object) "+e.name+" "+e.group+" "+e.filetype+" filename:"+r+"  marker:"+a+" "+e.marker+" "+t),i}objectLoadGroupId(e){let t=parseInt(e)-1;return null!=this.parent.markerIds&&(t=this.parent.markerIds[e]),t}objectProperties(e,t){var i={scale:t.scale,rotate:t.rotate};e.settings(i);let r=t.loader;e.loaderSet(r),null!=t.control&&e.control()}objectProfile(e){return APP.properties[e]}objectData(e){return this.parent.objectData(e)}objectType(e,t,i,r){let s,o=e.filetype;return"videoNormal"==o?s=new Q(e.filetype,e.name,i,r,t.scale):"video"==o?s=this.objectPreloadVideo(r,i):"obj"!=o&&"gltf"!=o||(s=new X(e.filetype,e.name,i,r,t.scale)),s}objectTypeObject(e){return new q(e.name,e.object)}objectFileURL(e,t,i,r){return APP.host+APP.objDir+i+"/"+t+"/"}objectFileName(e,t,i){return"video"==t?e+"."+i:e+"."+t}objectGroupAdd(e,t,i){let r=this.objectsGroup[e];null==r&&(r=[]),r.push(i),this.objectsGroup[e]=r,null==this.objectsGroupId[t]&&(this.objectsGroupId[t]=e)}objectGet(e,t){if(e!=this.groupSelect){if(!this.objectGroupSet(e))return window.APP.run.parent.objects(e,t),!1;this.groupSelect=e}let i=this.objectsGroupSelect[this.objectSelect],r=this.objects[i];return this.objectLoadSet(r),r}objectPromise(e){let t=[];e.then(function(e){return e}),t.push(e),Promise.all(t).then(e=>{console.log(e)})}objectIndexSet(e){e<this.objectsGroupSelect.length&&(this.objectSelect=e)}objectIndexGet(){return this.objectSelect}objectIndexFade(){this.objects[this.objectSelect]}objectGroupSet(e){this.objectSelect=0;let t=this.objectsGroupId[e];return console.log(t,e,this.objectsGroupId),null!=t&&(this.objectsGroupSelect=this.objectsGroup[t],this.objectGroupDataSet(),!0)}objectGroupDataSet(){this.objectsGroupSelectData=[];for(let e=0;e<this.objectsGroupSelect.length;e++){let t=this.objectsGroupSelect[e],i=this.objectsData[t];this.objectsGroupSelectData.push(i)}APP.run.parent.call("objectGroup",this.objectsGroupSelectData)}objectGroupData(){if(-1!=this.objectsGroupSelect)return this.objectsGroupSelectData}objectPreloadVideo(e,t){let i;var r=APP.video.width,s=APP.video.height,o=APP.video.imageWidth,a=APP.video.imageHeight,n=e,h=e+t;return null==(i=AKIT.store.get("ARTypePlaneVideoEffectVignette"))?i=new k(r,s,o,a,n,h,!1):i.reconstruct(r,s,o,a,n,h,!1),i}}class ee{constructor(){this.properties={}}init(){THREE.WebXRUtils.getDisplays().then(this.startXR)}startXR(e){console.log("webXR start",e);APP.renderer.xr=new THREE.WebXRManager({AR_AUTOSTART:!0},e,APP.renderer,AKIT.scene.camera,AKIT.scene,AKIT.sceneAR.frameXR),APP.renderer.xr.addEventListener("sessionStarted",AKIT.sceneAR.sessionXR)}sessionXR(){console.log("webXR session");let e=data.session.realityType;console.log(e)}frameXR(e){console.log("webXR frame",e)}frame(){}}class te{constructor(){this.properties={}}init(){console.log("web3AR init"),THREE.ARUtils.getARDisplay().then(function(e){e?AKIT.sceneAR.start(e):THREE.ARUtils.displayUnsupportedMessage()})}start(e){this.display=e,console.log("web3AR start",e),this.arview=new THREE.ARView(this.display,APP.renderer),this.camera=new THREE.ARPerspectiveCamera(this.display,60,window.innerWidth/window.innerHeight,this.display.depthNear,this.display.depthFar),this.vrcontrols=new THREE.VRControls(this.camera)}render(){APP.renderer.clearColor(),this.arview.render(),this.camera.updateProjectionMatrix(),this.vrcontrols.update(),APP.renderer.clearDepth()}frame(){}}class ie{constructor(e,t,i,r){this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.VIEW_ANGLE=APP.cameraDistanceViewAngle,this.ASPECT=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,this.NEAR=APP.cameraDistanceNear,this.FAR=APP.cameraDistanceFar,this.RSIZE=1,this.sceneType=APP.sceneType,this.windowLoaded=!1,null==AKIT.canvas&&(AKIT.canvas=document.createElement("canvas")),this.scene=t,this.effects={},this.options=e,APP.displayStats&&(this.stats=new Stats),window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("load",this.onWindowLoad,!1),APP.renderer=i,this.camera=r}init(){this.setStats&&(this.stats.domElement.style.position="absolute",this.stats.domElement.style.bottom="0px",this.stats.domElement.style.zIndex=100,AKIT.container.appendChild(this.stats.domElement)),this.initLight()}reset(){}stats(){this.setStats&&this.stats.update()}render(){}inworld(e){return-1!=this.scene.children.indexOf(e)}initLight(){this.light=new t,this.light.init()}onWindowResize(e){}onWindowLoad(e){}}class re{constructor(){this.properties={},this.properties.running=!1,this.properties.started=!1,this.points=[],this.pointsX=10,this.pointsY=10}init(){}load(){if(AKIT.loadedAR)if(this.properties.running){if(this.properties.started)return this.start(),!0}else this.run(),this.properties.running=!0;return!1}frame(){}resize(){var e=window.innerWidth,t=window.innerHeight;AKIT.canvas.width=e,AKIT.canvas.height=t}start(){this.resize(),console.log("8Wall start"),APP.run.started()}pointsUpdate(){var e=AKIT.sceneAR.points;e.length;for(const t in e){let i=e[t];i.confidence>.7&&console.log(t,i.confidence,i.position)}}run(){console.log("8Wall run"),XR.addCameraPipelineModules([XR.GlTextureRenderer.pipelineModule(),XR.Threejs.pipelineModule(),XR.XrController.pipelineModule(),{name:"toastar",onStart:({canvas:e,canvasWidth:t,canvasHeight:i})=>{const r=XR.Threejs.xrScene();AKIT.scene=new ie({},r.scene,r.renderer,r.camera),AKIT.scene.init(),console.log("8Wall set",APP.renderer,AKIT.scene,AKIT.scene.camera,this),XR.XrController.updateCameraProjectionMatrix({origin:AKIT.scene.camera.position,facing:AKIT.scene.camera.quaternion}),this.properties.started=!0}}]),XR.run({canvas:AKIT.canvas}),console.log("8Wall running",XR,AKIT.canvas)}}class se{constructor(e,t,i){this.parent=e,this.properties={},this.properties.cameraParametersUrl=t,this.properties.detectionMode=i,this.init()}init(){var e=new THREE.ArToolkitContext({cameraParametersUrl:this.properties.cameraParametersUrl,detectionMode:this.properties.detectionMode,canvasWidth:240,canvasHeight:180,maxDetectionRate:30}),t=this;e.init(function(){AKIT.scene.camera.projectionMatrix.copy(e.getProjectionMatrix()),t.parent.contextReady()}),this.properties.arcontext=e}update(e){this.properties.arcontext.update(e)}stop(){console.log("stop context",this.properties.arcontext)}}class oe{constructor(e,t){this.parent=e,this.ready=!1,this.domElement=null,this.parameters=APP.mediaDevices.parameters}setParameters(e){if(void 0!==e)for(var t in e){var i=e[t];this.parameters[t];this.parameters[t]=i}}init(){var e=this.initSourceWebcam();this.domElement=e,this.domElement.style.position="absolute",this.domElement.style.top="0px",this.domElement.style.left="0px",this.domElement.style.zIndex="-2",this.ready=!0}reinit(){this.setDeviceElement()}setDeviceElement(){var e=this;this.domElement.srcObject=AKIT.devices.mediaSrc,document.body.addEventListener("click",function(){e.domElement.play()})}initSourceWebcam(){var e=document.createElement("video");return e.setAttribute("muted",!0),e.setAttribute("autoplay",!0),e.setAttribute("playsinline",!0),e.setAttribute("controls",!0),setTimeout(()=>{e.removeAttribute("controls")}),e.style.width=this.parameters.displayWidth+"px",e.style.height=this.parameters.displayHeight+"px",e}domElementWidth(){return parseInt(this.domElement.style.width)}domElementHeight(){return parseInt(this.domElement.style.height)}onResizeElement(){var e=window.innerWidth,t=window.innerHeight;if(e/t<640/480){var i=640/480*t;this.domElement.style.width=i+"px",this.domElement.style.marginLeft=-(i-e)/2+"px",this.domElement.style.height=t+"px",this.domElement.style.marginTop="0px"}else{var r=1/(640/480/e);this.domElement.style.height=r+"px",this.domElement.style.marginTop=-(r-t)/2+"px",this.domElement.style.width=e+"px",this.domElement.style.marginLeft="0px"}}copyElementSizeTo(e){console.log("copy element",AKIT.windowWidth,AKIT.windowHeight,e),AKIT.windowWidth>AKIT.windowHeight?(e.style.width=this.domElement.style.width,e.style.height=this.domElement.style.height,e.style.marginLeft=this.domElement.style.marginLeft,e.style.marginTop=this.domElement.style.marginTop):(e.style.height=this.domElement.style.height,e.style.width=4*parseInt(this.domElement.style.height)/3+"px",e.style.marginLeft=(AKIT.windowWidth-parseInt(e.style.width))/2+"px",e.style.marginTop=0)}onReady(){this.parent.onResize()}}class ae{constructor(e,t){this.properties={},this.properties.sourceType=e,this.properties.context=t,this.copyElementTo=!0,this.init()}init(){let e=this,t=new oe(this,{sourceType:this.properties.sourceType});this.properties.arsource=t,this.properties.arsource.init(),this.properties.arsource.init(function(){e.onResize()}),APP.sourceAR.appendChild(t.domElement),window.addEventListener("resize",function(){e.onResize()})}reinit(){this.properties.arsource.reinit()}start(){this.reinit()}resizeCopyElement(e){this.copyElementTo=e}onResize(){this.properties.arsource.onResizeElement(),this.copyElementTo&&(this.properties.arsource.copyElementSizeTo(APP.renderer.domElement),null!==this.properties.context.arController&&this.properties.arsource.copyElementSizeTo(this.properties.context.arController.canvas)),null!==this.properties.context.arController&&AKIT.scene.camera.projectionMatrix.copy(this.properties.context.getProjectionMatrix())}isReady(){return this.properties.arsource.ready}getDomElement(){return this.properties.arsource.domElement}stop(){this.properties.arsource.domElement.pause(),this.stopStreamedVideo(this.properties.arsource.domElement)}stopStreamedVideo(e){e.srcObject.getTracks().forEach(function(e){e.stop()}),e.srcObject=null}}class ne{constructor(e,t,i){this.properties={},this.properties.sourceType=e,this.properties.cameraParametersUrl=t,this.properties.detectionMode=i,this.context=new se(this,this.properties.cameraParametersUrl,this.properties.detectionMode),this.source=new ae(this.properties.sourceType,this.context.properties.arcontext),(APP.system="aframe")&&this.source.resizeCopyElement(!1)}start(){this.source.start()}stop(){this.source.stop(),this.context.stop()}init(){}contextReady(){AKIT.scene.window(),this.source.onResize()}frame(){if(!1===this.source.isReady())return!0;this.context.properties.arcontext.update(this.source.properties.arsource.domElement),AKIT.scene.scene.visible=AKIT.scene.camera.visible}}class he{constructor(e,t,i,r){this.parent=e,this.context=t,this.parameters={size:1,type:"unknown",patternUrl:null,barcodeValue:null,changeMatrixMode:"modelViewMatrix",minConfidence:.6};var s=["pattern","barcode","unknown"];console.assert(-1!==s.indexOf(this.parameters.type),"illegal value",this.parameters.type);s=["modelViewMatrix","cameraTransformMatrix"];console.assert(-1!==s.indexOf(this.parameters.changeMatrixMode),"illegal value",this.parameters.changeMatrixMode),this.object3d=i,this.object3d.matrixAutoUpdate=!1,this.object3d.visible=!1,this.setParameters(r),t.addMarker(this),"artoolkit"===this.context.parameters.trackingBackend?this._initArtoolkit():"aruco"===this.context.parameters.trackingBackend?this._arucoPosit=new POS.Posit(this.parameters.size,this.context.arucoContext.canvas.width):"tango"===this.context.parameters.trackingBackend?this._initTango():console.assert(!1)}dispose(){this.context.removeMarker(this)}setParameters(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)void 0!==this.parameters[t]?this.parameters[t]=i:console.warn("THREEx.ArMarkerControls: '"+t+"' is not a property of this material.");else console.warn("THREEx.ArMarkerControls: '"+t+"' parameter is undefined.")}}name(){var e="";(e+=this.parameters.type,"pattern"===this.parameters.type)?e+=" - "+this.parameters.patternUrl.replace(/^.*\//g,""):"barcode"===this.parameters.type?e+=" - "+this.parameters.barcodeValue:console.assert(!1,"no .name() implemented for this marker controls");return e}_initArtoolkit(){var e=this,t=setInterval(function(){null!==e.context.arController&&(clearInterval(t),t=null,e.postInit())},20)}postInit(){var e=this;let t;var i=e.context.arController;"pattern"===e.parameters.type?i.loadMarker(e.parameters.patternUrl,function(r){t=r,i.trackPatternMarkerId(t,e.parameters.size)}):"barcode"===e.parameters.type?(t=e.parameters.barcodeValue,i.trackBarcodeMarkerId(t,e.parameters.size)):"unknown"===e.parameters.type?t=null:console.log(!1,"invalid marker type",e.parameters.type),i.addEventListener("getMarker",function(i){if(i.data.type===artoolkit.PATTERN_MARKER&&"pattern"===e.parameters.type){if(null===t)return;i.data.marker.idPatt===t&&e.onMarkerFound(i)}else if(i.data.type===artoolkit.BARCODE_MARKER&&"barcode"===e.parameters.type){if(null===t)return;i.data.marker.idMatrix===t&&e.onMarkerFound(i)}else i.data.type===artoolkit.UNKNOWN_MARKER&&"unknown"===e.parameters.type&&e.onMarkerFound(i)})}onMarkerFound(e){e.data.type===artoolkit.PATTERN_MARKER&&e.data.marker.cfPatt<this.parameters.minConfidence||e.data.type===artoolkit.BARCODE_MARKER&&e.data.marker.cfMatt<this.parameters.minConfidence||this.parent.markerFound(e.data.marker.idPatt,e.data.marker.cfPatt,e.data.matrix)}_initAruco(){this._arucoPosit=new POS.Posit(this.parameters.size,this.context.arucoContext.canvas.width)}_initTango(){console.log("init tango ArMarkerControls")}}class ce extends c{constructor(e,t,i,r,s,o,a,n){super(),this.properties.id=e,this.properties.parent=t,this.properties.type=s,this.properties.patternUrl=o,this.properties.imgUrl=a,this.properties.changeMatrixMode=n,this.properties.object3D="camera"==r?AKIT.scene.camera:r,this.init(i)}init(e){let t=new he(this.properties.parent,e,this.properties.object3D,{type:this.properties.type,patternUrl:this.properties.patternUrl,changeMatrixMode:this.properties.changeMatrixMode});this.properties.armarkerctl=t}initx(e){let t=new THREEx.ArMarkerControls(e,this.properties.object3D,{type:this.properties.type,patternUrl:this.properties.patternUrl,changeMatrixMode:this.properties.changeMatrixMode});this.properties.armarkerctl=t}}class de{constructor(e){this.parent=e,this.context=AKIT.sceneAR.scene.context.properties.arcontext,this.markers=[],this.markerCodes={},this.objects={},this.timer=[],this.markerActive=-1,this.objectActive=-1,this.objectConfidence=0,this.object3d=AKIT.scene.camera,this.timeoutObject=100}addMarker(e,t,i,r){this.changeMatrixMode="cameraTransformMatrix",this.markerScheme=r;let s=APP.markerDirectory+t+"/"+i,o=APP.markerDirectory+t+"/marker.png",a=new ce(e,this,this.context,"camera","pattern",s,o,this.changeMatrixMode);this.markers.push(a);let n=this.markers.length-1;return this.markerCodes[n]=t,this.timer.push(Date.now()),a}addModelObject(e,t){this.objects[e]=t}markerCycle(){if(-1!=this.markerActive){Date.now()-this.timer[this.markerActive]>this.timeoutObject&&(this.clearObject(this.markerActive),this.markerActive=-1,this.objectConfidence=0,this.setMarkerInActive())}}markerFound(e,t,i){const r=this.markerCodes[e];"objectSelect"==this.markerScheme?this.markerSchemeSelect(e,r,t,i):this.markerSchemePer(e,r,t,i)}setMarkerActive(){APP.run.parent.markerVisibleUpdated(!0)}setMarkerInActive(){APP.run.parent.markerVisibleUpdated(!1)}markerSchemePer(e,t,i,r){let s=!1;if(e!=this.markerActive)if(i>=this.objectConfidence)s=!0;else{Date.now()-this.timer[this.markerActive]>this.timeoutObject&&(s=!0)}else s=!0;s&&this.setObject(e,t)&&(this.markerActive!=e&&this.clearObject(this.markerActive),this.markerActive=e,this.objectConfidence=i,this.setMarkerActive()),this.updateMatrix(r),this.timer[e]=Date.now()}setObject(e,t){let i=this.getObject(e,t);return 0!=i&&(this.objectActive!=i&&(-1!=this.objectActive&&this.objectActive.activeUnset(),this.objectActive=i),i.activeSet())}clearObject(e){if(-1!=e){let t=this.getObject(e);null!=t&&t.activeUnset()}}markerSchemeSelect(e,t,i,r){if(this.parent.objectSelect!=this.parent.objectSelected){var s=this.parent.objectSelect;this.parent.objectSelect=this.parent.objectSelected,-1!=s&&this.clearObjectSelect(e,s),this.setObjectSelect(e,this.parent.objectSelect)}this.updateMatrix(r)}setObjectSelect(e,t){let i=this.objects[e],r=this.getObject(i);return null!=r&&(r.markerActive(),!0)}clearObjectSelect(e,t){let i=this.objects[e];if(null!=i){this.getObject(i).markerInActive()}}getObject(e,t){return this.parent.objectGet(e,t)}updateMatrix(e){var t=(new THREE.Matrix4).fromArray(e);this.updateWithModelViewMatrix(t)}updateWithModelViewMatrix(e){var t=this.object3d;if(t.visible=!0,"artoolkit"===this.context.parameters.trackingBackend){var i=(new THREE.Matrix4).copy(this.context._artoolkitProjectionAxisTransformMatrix);i.multiply(e),e.copy(i)}else"aruco"===this.context.parameters.trackingBackend||"tango"===this.context.parameters.trackingBackend||console.assert(!1);if("tango"!==this.context.parameters.trackingBackend){var r=(new THREE.Matrix4).makeRotationX(Math.PI/2);e.multiply(r)}"modelViewMatrix"===this.changeMatrixMode?t.matrix.copy(e):"cameraTransformMatrix"===this.changeMatrixMode?t.matrix.getInverse(e):console.assert(!1),t.matrix.decompose(t.position,t.quaternion,t.scale)}}class le{constructor(){this.properties={}}init(){const e=APP.arjs.cameraParametersUrl;this.scene=new ne("webcam",e,"mono"),this.scene.init()}marker(e){return new de(e)}start(){this.scene.start()}stop(){null!=this.scene&&this.scene.stop()}frame(){this.scene.frame()}}class pe{constructor(e){this.parent=e,this.parent.deviceCheck=!1}startARPlatform(e){this.platform=e,"arjs"==e?this.initARJS():"webxr"==e?this.initWebXR():"web3ar"==e?this.initWeb3AR():"8wall"==e?this.init8Wall():"tracking"==e?this.initTracking():"opencv"==e&&this.initOpenCV()}load(){this.render=!1,"arjs"==this.platform?this.loadARJS():"webxr"==this.platform||"web3ar"==this.platform||"8wall"==this.platform||this.platform}stop(){"arjs"==this.platform?this.stopARJS():"webxr"==this.platform||"web3ar"==this.platform||this.platform}check(){if("arjs"==this.platform)this.initARJSCheck(),this.loadARJSCheck();else if("tracking"==this.platform)this.loadTracking();else if("opencv"==this.platform)this.loadOpenCV();else if("8wall"==this.platform)return this.load8WAll();return!0}initOpenCV(){0==AKIT.scene&&(AKIT.scene=AKIT.getSceneObject(),AKIT.scene.init(),APP.run.scene(),this.parent.setSource(),APP.run.app.initAppScene())}loadOpenCV(){AKIT.sceneAR.init(),this.parent.marker(),AKIT.sceneAR.start()}initTracking(){0==AKIT.scene&&(AKIT.scene=AKIT.getSceneObject(),AKIT.scene.init(),APP.run.scene(),this.parent.setSource(),APP.run.app.initAppScene())}loadTracking(){AKIT.sceneAR.init(),this.parent.marker(),AKIT.sceneAR.start()}initWebXR(){AKIT.sceneAR=new ee,AKIT.sceneAR.init()}initWeb3AR(){AKIT.sceneAR=new te,AKIT.sceneAR.init()}init8Wall(){AKIT.sceneAR=new re,AKIT.sceneAR.init(),this.parent.env()}load8WAll(){return AKIT.sceneAR.load()}initARJS(){console.log("initARJS"),0==AKIT.scene&&(AKIT.scene=AKIT.getSceneObject()),AKIT.scene.init(),APP.run.scene(),this.parent.setSource(),AKIT.sceneAR=new le}initARJSCheck(){AKIT.sceneAR.init(),this.parent.marker()}loadARJS(){}loadARJSCheck(){this.startARJS()}startARJS(){AKIT.sceneAR.start()}stopARJS(){AKIT.sceneAR.stop(),this.parent.unsetVideoElement(),AKIT.scene.reset()}}class ue{constructor(){}buttonMode(){this.lib={createButton:function(e,t){function i(t){o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR",o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){t.isPresenting?t.exitPresent():t.requestPresent([{source:e.domElement}])},e.vr.setDevice(t)}function r(){o.style.display="",o.style.cursor="auto",o.style.left="calc(50% - 75px)",o.style.width="150px",o.textContent="VR NOT FOUND",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null,e.vr.setDevice(null)}function s(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#000",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}var o;if("xr"in navigator)return(o=document.createElement("button")).style.display="none",s(o),navigator.xr.requestDevice().then(function(i){i.supportsSession({immersive:!0,exclusive:!0}).then(function(){!function(i){var r=null;function s(i){void 0===t&&(t={}),void 0===t.frameOfReferenceType&&(t.frameOfReferenceType="stage"),i.addEventListener("end",a),e.vr.setSession(i,t),o.textContent="EXIT VR",r=i}function a(t){r.removeEventListener("end",a),e.vr.setSession(null),o.textContent="ENTER VR",r=null}o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR",o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){null===r?i.requestSession({immersive:!0,exclusive:!0}).then(s):r.end()},e.vr.setDevice(i)}(i)}).catch(r)}).catch(r),o;if("getVRDisplays"in navigator)return(o=document.createElement("button")).style.display="none",s(o),window.addEventListener("vrdisplayconnect",function(e){i(e.display)},!1),window.addEventListener("vrdisplaydisconnect",function(e){r()},!1),window.addEventListener("vrdisplaypresentchange",function(e){o.textContent=e.display.isPresenting?"EXIT VR":"ENTER VR"},!1),window.addEventListener("vrdisplayactivate",function(t){t.display.requestPresent([{source:e.domElement}])},!1),navigator.getVRDisplays().then(function(e){e.length>0?i(e[0]):r()}).catch(r),o;var a=document.createElement("a");return a.href="https://webvr.info",a.innerHTML="WEBVR NOT SUPPORTED",a.style.left="calc(50% - 90px)",a.style.width="180px",a.style.textDecoration="none",s(a),a}}}}class me{constructor(e){this.parent=e,this.properties={},this.mode=0,this.webvr()}webvr(){null==window.WEBVR&&(this.webVR=new ue,this.webVR.buttonMode(),this.mode="button",window.WEBVR=this.webVR.lib)}startVRPlatform(e){this.platform=e,this.initWebVR()}load(){this.propertiesSet(),AKIT.scene.resetCamera()}stop(){this.propertiesUnSet(),AKIT.scene.reset()}initWebVR(){if(0==AKIT.scene){AKIT.scene=AKIT.getSceneObject(),AKIT.scene.init(),APP.run.scene(),this.parent.setSceneWindow();let e=this;window.addEventListener("resize",function(){e.resize()}),APP.run.resize(),AKIT.scene.window(),e.resize()}}resize(){APP.renderer.domElement.width=AKIT.windowWidth,APP.renderer.domElement.height=AKIT.windowHeight,APP.renderer.domElement.style.width=AKIT.windowWidth+"px",APP.renderer.domElement.style.height=AKIT.windowHeight+"py",AKIT.canvas.width=AKIT.windowWidth,AKIT.canvas.height=AKIT.windowHeight}set(){"button"==this.mode&&this.enableButtonVR()}enableButtonVR(){APP.renderer.vr.enabled=!0,document.body.appendChild(WEBVR.createButton(APP.renderer)),AKIT.alogKit(" (scene-vr-ready) vR Display:"+AKIT.vrDisplay)}propertiesSet(){let e=APP.sceneOptions;null!=e.background3D&&(AKIT.scene.scene.background=e.background3D),null!=e.grid&&this.gridAdd(e.worldSize)}propertiesUnSet(){null!=APP.sceneOptions.grid&&this.gridRemove()}skybox(){}gridAdd(e){null==this.properties.grid&&(this.properties.grid=new THREE.GridHelper(100,e,16777215,16777215),this.properties.grid.position.set(0,0,0)),AKIT.scene.scene.add(this.properties.grid),this.properties.grid.visible=!0}gridRemove(e){null!=this.properties.grid&&AKIT.scene.scene.remove(this.properties.grid)}}class ve{constructor(e){this.parent=e,this.context=AKIT.sceneAR.scene.context.properties.arcontext,this.object3d=AKIT.scene.camera,this.changeMatrixMode="cameraTransformMatrix"}updateMatrix(e){var t=(new THREE.Matrix4).fromArray(e);this.updateWithModelViewMatrix(t)}updateWithModelViewMatrix(e){var t=this.object3d;if(t.visible=!0,"artoolkit"===this.context.parameters.trackingBackend){var i=(new THREE.Matrix4).copy(this.context._artoolkitProjectionAxisTransformMatrix);i.multiply(e),e.copy(i)}else"aruco"===this.context.parameters.trackingBackend||"tango"===this.context.parameters.trackingBackend||console.assert(!1);if("tango"!==this.context.parameters.trackingBackend){var r=(new THREE.Matrix4).makeRotationX(Math.PI/2);e.multiply(r)}"modelViewMatrix"===this.changeMatrixMode?t.matrix.copy(e):"cameraTransformMatrix"===this.changeMatrixMode?t.matrix.getInverse(e):console.assert(!1),t.matrix.decompose(t.position,t.quaternion,t.scale)}}class ge{constructor(e,t){this.parent=e,this.url=t,this.training(),this.add(),this.debugObjs=[]}add(){AKIT.sceneAR.add(this)}frame(){this.match()}onMarkerFound(e){this.parent.markerFound(e.data.marker.idPatt,e.data.marker.cfPatt,e.data.matrix)}match(){window.innerWidth,window.innerHeight;var e=tracking.Brief.reciprocalMatch(this.corners,this.descriptors,AKIT.sceneAR.corners,AKIT.sceneAR.descriptors);e.sort(function(e,t){return t.confidence-e.confidence});for(var t=0;t<e.length;t++){null==this.debugObjs[t]&&(this.debugObjs[t]=new g(.01,4,4),this.debugObjs[t].add());var i=e[t].keypoint2,r=i[0]/640*2-1,s=-i[1]/480*2+1;this.debugObjs[t].positionXYZ(r,s,-5)}}training(){var e=this,t=new Image;t.onload=function(){e.train(t)},t.src=this.url}train(e){AKIT.scene.windowSet(640,480),AKIT.sceneAR.source.onResize(),APP.renderer.domElement.style.width=640,APP.renderer.domElement.style.height=480,console.log(APP.renderer.domElement);this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=640,this.canvas.height=480,this.context.drawImage(e,0,0,50,50);var t=this.context.getImageData(0,0,640,480),i=tracking.Image.grayscale(tracking.Image.blur(t.data,640,480,3),640,480);let r=tracking.Fast.findCorners(i,640,480);this.descriptors=tracking.Brief.getDescriptors(i,640,r),this.corners=r,console.log("train",this.url,640,480,50,50,this.descriptors.length,r.length)}cornersDebug(){AKIT.canvas;for(var e=AKIT.sceneAR.corners,t=(window.innerWidth,window.innerHeight,0);t<e.length;t+=2){null==this.debugObjs[t]&&(this.debugObjs[t]=new g(.01,4,4),this.debugObjs[t].add());let s=.1;var i=(e[t]/640*2-1)*s,r=(-e[t+1]/480*2+1)*s;if(this.debugObjs[t].positionXYZ(i,r,-1),t>500)break}}}class Ae extends c{constructor(e,t,i){super(),this.properties.id=e,this.properties.parent=t,this.properties.imgUrl=i,this.init()}init(){this.properties.marker=new ge(this.properties.parent,this.properties.imgUrl)}}class Pe extends c{constructor(e,t,i){super(),this.properties.id=e,this.properties.parent=t,this.properties.imgUrl=i,this.init()}init(){}}class Te{constructor(e){this.parent=e,this.markers=[],this.markerCodes={},this.objects={},this.timer=[],this.markerActive=-1,this.objectActive=-1,this.objectConfidence=0,this.object3d=AKIT.scene.camera,this.timeoutObject=100}addMarker(e,t,i,r){let s,o;console.log("addMarker",e,t,i,r),"arjs"==APP.platformAR?(s={id:(o=this.addMarkerARJS(e,t,i)).properties.id+1,file:o.properties.imgUrl},this.matrix=this.addMarkerMatrixARJS()):"tracking"==APP.platformAR?o=this.addMarkerTracking(e,t,i,r):"opencv"==APP.platformAR&&(o=this.addMarkerOpenCV(e,t,i,r)),this.markerScheme=r,this.markers.push(o);let a=this.markers.length-1;return this.markerCodes[a]=t,this.timer.push(Date.now()),s}addMarkerARJS(e,t,i){this.changeMatrixMode="cameraTransformMatrix";let r=APP.markerDirectory+t+"/"+i,s=APP.markerDirectory+t+"/marker.png",o=AKIT.sceneAR.scene.context.properties.arcontext;return new ce(e,this,o,"camera","pattern",r,s,this.changeMatrixMode)}addMarkerMatrixARJS(){return new ve(this)}addMarkerTracking(e,t,i,r){let s=APP.markerDirectory+t+"/marker.png";return new Ae(e,this,s)}addMarkerOpenCV(e,t,i,r){let s=APP.markerDirectory+t+"/marker.png";return new Pe(e,this,s)}addModelObject(e,t){this.objects[e]=t}markerCycle(){if(-1!=this.markerActive){Date.now()-this.timer[this.markerActive]>this.timeoutObject&&(this.clearObject(this.markerActive),this.markerActive=-1,this.objectConfidence=0,this.setMarkerInActive())}}markerFound(e,t,i){const r=this.markerCodes[e];"objectSelect"==this.markerScheme?this.markerSchemeSelect(e,r,t,i):this.markerSchemePer(e,r,t,i)}setMarkerActive(){APP.run.parent.markerVisibleUpdated(!0)}setMarkerInActive(){APP.run.parent.markerVisibleUpdated(!1)}markerSchemePer(e,t,i,r){let s=!1;if(e!=this.markerActive)if(i>=this.objectConfidence)s=!0;else{Date.now()-this.timer[this.markerActive]>this.timeoutObject&&(s=!0)}else s=!0;s&&this.setObject(e,t)&&(this.markerActive!=e&&this.clearObject(this.markerActive),this.markerActive=e,this.objectConfidence=i,this.setMarkerActive()),this.matrix.updateMatrix(r),this.timer[e]=Date.now()}setObject(e,t){let i=this.getObject(e,t);return 0!=i&&(this.objectActive!=i&&(-1!=this.objectActive&&this.objectActive.activeUnset(),this.objectActive=i),i.activeSet())}clearObject(e){if(-1!=e){let t=this.getObject(e);null!=t&&t.activeUnset()}}markerSchemeSelect(e,t,i,r){if(this.parent.objectSelect!=this.parent.objectSelected){var s=this.parent.objectSelect;this.parent.objectSelect=this.parent.objectSelected,-1!=s&&this.clearObjectSelect(e,s),this.setObjectSelect(e,this.parent.objectSelect)}this.matrix.updateMatrix(r)}setObjectSelect(e,t){let i=this.objects[e],r=this.getObject(i);return null!=r&&(r.markerActive(),!0)}clearObjectSelect(e,t){let i=this.objects[e];if(null!=i){this.getObject(i).markerInActive()}}getObject(e,t){return this.parent.objectGet(e,t)}}class we{constructor(e){this.parent=e,this.objects={},this.timer=[],this.focusObjectActive=-1,this.timeoutObject=100,this.groupId="1",this.groupCode="1",this.focusObject={},this.focusObjectId=-1,this.event={place:!1}}setEnvEvent(e,t,i){"place"==e&&this.setEnvEventPlace(i.point)}setEnvEventPlace(e){this.event.place||(this.event.place=!0,this.envAddFocusObject(this.groupId,this.groupCode,1,{point:e}))}envCycle(){null!=this.focusObject.id&&this.envUpdFocusObject()}setEnvActive(){APP.run.parent.markerVisibleUpdated(!0)}setEnvInActive(){APP.run.parent.markerVisibleUpdated(!1)}envAddFocusObject(e,t,i,r){this.focusObject={id:e,code:t,conf:i,opt:r}}envDelFocusObject(e,t,i,r){this.focusObject={}}envUpdFocusObject(){this.setFocusObject(this.focusObject.id,this.focusObject.code,this.focusObject.opt)&&(this.focusObjectId!=this.focusObject.id&&this.clearObject(this.focusObject.id,this.focusObject.opt),this.focusObjectId=this.focusObject.id,this.setEnvActive()),this.timer[this.focusObject.id]=Date.now()}setFocusObject(e,t,i){let r=this.getObject(e,t);return 0!=r&&(this.focusObjectActive!=r&&(-1!=this.focusObjectActive&&this.focusObjectActive.activeUnset(i),this.focusObjectActive=r),r.activeSet(i))}clearObject(e,t){if(-1!=e){let i=this.getObject(e);null!=i&&i.activeUnset(t)}}getObject(e,t){return this.parent.objectGet(e,t)}}class be{constructor(){this.startedAR=!1,this.startedVR=!1,this.objectFocus=0}initProperties(){APP.UI.data.HeightDefault=.6*this.markerDistance,APP.UI.data.WidthDefault=.6*this.markerDistance,APP.UI.data.DepthDefault=1*this.markerDistance,APP.UI.data.Height=APP.UI.data.HeightDefault,APP.UI.data.Width=APP.UI.data.WidthDefault,APP.UI.data.Depth=APP.UI.data.DepthDefault,"arjs"==APP.platformAR&&(this.markerDistance=APP.arjs.markerDistance)}initApp(){this.render=!1,this.deviceCheck=!1,this.objectsInit()}resize(){this.setSceneWindow()}setSource(){null==APP.sourceAR&&(APP.sourceAR=document.getElementById("appscene"))}setElement(){document.getElementById("appscene")}setElement1(){document.getElementById("appscene")}setCanvas(){}setSceneWindow(){null!=document.getElementById("appscene")&&(AKIT.windowHeight=window.innerHeight,AKIT.windowWidth=window.innerWidth)}unsetCanvas(){document.getElementById("appscene").removeChild(AKIT.canvas)}setVideoElement(){if(null==AKIT.bgtexture){let e=this.getVideo();AKIT.bgtexture=new THREE.VideoTexture(e),AKIT.bgtexture.minFilter=THREE.LinearFilter,AKIT.bgtexture.magFilter=THREE.LinearFilter,AKIT.bgtexture.format=THREE.RGBFormat}AKIT.scene.scene.background=AKIT.bgtexture}unsetVideoElement(){AKIT.scene.scene.background=new THREE.Color(16777215)}addIFrame(){let e=document.getElementById("appscene");var t=document.createElement("iframe");t.setAttribute("src","assets/lib/arjs/arjs-frame.html"),console.log(t),e.appendChild(t)}getVideo(){return AKIT.sceneAR.scene.source.properties.arsource.domElement}startVR(e){this.startVRPlatform(e)}startedVRCheck(){return this.startedVR}startVRApp(){null==this.vr&&(this.vr=new me(this))}startVRPlatform(e){this.startedVR=!0,this.startVRApp(),this.vr.startVRPlatform(e)}loadVR(){this.startVRApp(),this.vr.load()}stopVR(){this.vr.stop()}startAR(e){this.startARPlatform(e)}startedARCheck(){return this.startedAR}startARApp(){null==this.ar&&(this.ar=new pe(this))}checkedARApp(){return this.ar.check()}startARPlatform(e){this.startedAR=!0,this.startARApp(),this.ar.startARPlatform(e)}loadAR(){this.render=!1,this.startARApp(),this.ar.load()}cycleAR(){this.render?(AKIT.scene.render(),AKIT.sceneAR.frame(),null!=this.markerMgr&&(this.markerMgr.markerCycle(),this.markerVisible=this.markerMgr.markerActive),null!=this.envMgr&&this.envMgr.envCycle()):(this.deviceCheck||AKIT.devices.checkDeviceReady()&&(this.deviceCheck=!0),this.checkedARApp()&&(this.render=!0))}stopAR(){this.render=!1,this.ar.stop()}loadARJS(){}env(){this.envMgr=new we(this)}marker(){this.markerMgr=new Te(this),this.markers()}markers(){this.markerIds={};const e=APP.markers;let t=[];for(let i=0;i<e.length;i++){let r=e[i],s=i,o=this.markerMgr.addMarker(s,r.name,r.marker,r.scheme);this.markerIds[r.name]=s,t.push(o)}APP.run.parent.call("markerGroup",t)}objectsLoad(e){return this.objectsAR.objectsLoad(e)}objectsInit(){this.objectsAR=new $(this),this.objectsAR.init()}objectAnchor(e){this.objectsAR.loadAnchor(e)}object(e){this.objectsAR.loadObj(e)}objects(e){this.objectsAR.load(e)}objectGet(e,t){return this.objectsAR.objectGet(e,t)}objectData(e){return{}}objectIndexSet(e){this.objectsAR.objectIndexSet(e)}objectIndexGet(e){return this.objectsAR.objectIndexGet(e)}objectIndexFade(){this.objectsAR.objectIndexFade()}objectGroupDataSet(){this.objectsAR.objectGroupDataSet()}setFocusAction(e,t){"autoplay"==e&&null!=t.properties.video&&(this.objectFocus=t.properties.video,this.objectFocusAction="autoplay")}clearFocusAction(){this.objectFocus=0,this.objectFocusAction=""}eventGlobalTouchEnd(){0!=this.objectFocus&&"autoplay"==this.objectFocusAction&&null!=this.objectFocus.properties.video&&this.objectFocus.properties.video.play()}}class fe{constructor(){this.init()}init(){APP.UI={},APP.UI.data={},APP.UI.data.Height=0,APP.UI.data.Width=0,APP.UI.data.Depth=0,APP.UI.data.HeightDefault=0,APP.UI.data.WidthDefault=0,APP.UI.data.DepthDefault=0,APP.UI.updateUI=function(){var e=document.getElementById("theight").value,t=document.getElementById("twidth").value,i=document.getElementById("tdepth").value;APP.UI.data.Height=""==e?APP.UI.data.HeightDefault:e,APP.UI.data.Width=""==t?APP.UI.data.WidthDefault:t,APP.UI.data.Depth=""==i?APP.UI.data.DepthDefault:i,APP.run.app.updateThing()}}}class ye extends be{constructor(){super(),AKIT.alogApp("app_app: (new)")}init(){this.initUI(),this.initProperties(),this.initApp(),AKIT.alogApp("app_app: (ready)")}initUI(){this.ui=new fe}start(){}stop(){}cycle(){this.cycleAR()}eventDown(){}eventUp(){}eventDrag(){}objectData(e){let t=e.title,i=e.desc,r=e.filetype;return{title:t[APP.language],description:i[APP.language],filetype:r}}}class Re{constructor(){console.log("app run 0"),APP.directory=window.location.pathname,AKIT.loader=new y,AKIT.loader.add("spinner",{size:1,len:1,rotate:{x:-.5,y:0,z:0}}),AKIT.video=new z,AKIT.env=new n,this.objectStore=new O,AKIT.initObjectStore(),this.app=new ye,console.log("app run 1"),AKIT.running=!1}init(){this.app.init()}start(){this.app.start(),AKIT.running=!0,AKIT.alogKit("(app-start) ")}stop(){this.running=!1,AKIT.alogKit(" (app-stop) ")}animate(){}scene(){}step(){setInterval(function(){AKIT.running&&(APP.run.app.cycle(),AKIT.video.cycle())},1e3/29.97)}control(){AKIT.control=new AKIT_ObjectTypePlaneWorldControl3DRay(this.app,2,2,8,8),AKIT.control.init(),AKIT.control.resize(),AKIT.control.rotationXYZRadians(-.5,0,0)}canvasSet(e){AKIT.canvas=e}parentSet(e){this.parent=e}resize(){this.app.resize()}}class Ee{constructor(){this.video="",this.info={device:"",os:"",browser:"",mediaDevices:"ok"},this.mediaSrc=0,this.deviceList=[],this.deviceSelected=!1,this.startRoute="/home"}deviceMsg(e,t,i){var r="DEVICE:"+e+JSON.stringify(t);console.log(r),i&&alert(r)}deviceAlert(e){alert(e)}deviceAction(e,t){if("redirect"==e){var i=APP.pages[t];this.startRoute=i}}setStartRoute(e){this.startRoute=e}getStartRoute(){return this.startRoute}initInfoDevices(){return this.infoDevice(),this.infoDeviceMedia(),"arjs"==APP.platformAR?this.infoDeviceActionsSet1():this.infoDeviceActionsSet2()}infoDeviceActionsSet1(){return!!this.infoDeviceActions()&&(this.infoDeviceParams(),!0)}infoDeviceActionsSet2(){return!0}initMediaDevices(e){if(this.checkDeviceMedia())return this.setDeviceMediaConstraints(e,APP.mediaDevices.parameters),!0}checkDeviceReady(){return 0!=this.mediaSrc&&-1!=this.mediaSrc}infoDevice(){var e=new ClientJS;if(this.info.browser=e.getBrowser(),this.info.browserVersion=e.getBrowserMajorVersion(),this.info.engine=e.getEngine(),this.info.browsercn=this.checkChineseBrowser(),this.info.osVersion=parseInt(e.getOSVersion()),e.isMobile())if(this.info.device="mobile",e.isMobileAndroid())this.info.os="android";else if(e.isMobileIOS()){this.info.os="ios",e.isSafari()&&(this.info.browser="safari")}else this.info.os="other";else this.info.device="desktop",e.isMobileIOS()&&(this.info.os="ipad");var t=APP.platformAR+" "+JSON.stringify(this.info);this.deviceMsg("user info:"+t,!1)}infoDeviceActions(){if("ios"==this.info.os){if("safari"!=this.info.browser){if("Wechat"==this.info.browsercn)return this.deviceAction("redirect","wechat"),!1;if("ok"!=this.info.mediaDevices){var e="This browser is not supported, please open in Safari. "+this.info.mediaDevices;this.deviceAlert(e)}else{e="This browser is not supported, please open in Safari. ";this.deviceAlert(e)}return!1}if(this.info.osVersion<12){e="You may encounter issues with this version of IOS, please upgrade your IOS version for best experience. Click to continue. "+this.info.osVersion;this.deviceAlert(e)}}else{if("Wechat"==this.info.browsercn)return this.deviceAction("redirect","wechat"),!1;if("ok"!=this.info.mediaDevices){e="This browser is not supported, please open in Chrome, Firefox or other browser that supports WebRTC. "+this.info.mediaDevices;return this.deviceAlert(e),!1}}return!0}deviceActionOpenBrowser(){window.open(APP.host)}infoDeviceMedia(){if(void 0===navigator.mediaDevices||void 0===navigator.mediaDevices.enumerateDevices||void 0===navigator.mediaDevices.getUserMedia){if(void 0===navigator.mediaDevices)var e="navigator.mediaDevices";else if(void 0===navigator.mediaDevices.enumerateDevices)e="navigator.mediaDevices.enumerateDevices";else if(void 0===navigator.mediaDevices.getUserMedia)e="navigator.mediaDevices.getUserMedia";this.info.mediaDevices="WebRTC error:"+e+" not available"}}infoDeviceParams(){let e="1";"desktop"==this.info.device&&(APP.mediaDevices.parameters=APP.mediaDevices.parameters2,e="2"),"ios"==this.info.os&&this.info.osVersion<12&&(APP.mediaDevices.parameters=APP.mediaDevices.parameters2,e="2"),this.deviceMsg("device params:"+e,"",!1)}checkDeviceMedia(){if(void 0===navigator.mediaDevices||void 0===navigator.mediaDevices.enumerateDevices||void 0===navigator.mediaDevices.getUserMedia){if(void 0===navigator.mediaDevices)var e="navigator.mediaDevices";else if(void 0===navigator.mediaDevices.enumerateDevices)e="navigator.mediaDevices.enumerateDevices";else if(void 0===navigator.mediaDevices.getUserMedia)e="navigator.mediaDevices.getUserMedia";return this.onError("WebRTC error:"+e+" not available"),!1}return!0}setDeviceMediaConstraints(e,t){var i={audio:!1,video:{facingMode:"environment",width:{ideal:t.sourceWidth},height:{ideal:t.sourceHeight}}};this.setDeviceConstraints(e,t,i)}setDeviceMediaConstraintsId(e,t,i){var r={audio:!1,video:{},deviceId:i};this.setDeviceConstraints(e,t,r)}setDeviceConstraints(e,t,i){var r=this;navigator.mediaDevices.enumerateDevices().then(function(s){r.deviceDebug(r,s),null!==t.deviceId&&(i.video.deviceId={exact:t.deviceId}),navigator.mediaDevices.getUserMedia(i).then(function(t){r.deviceMsg("stream:",t,!1),r.setDeviceStream(t),r.deviceSuccess(e)}).then(()=>r.deviceListCheck())})}setDeviceStream(e){this.mediaSrc=e}deviceDebug(e,t){e.deviceList=[];for(var i=t.length-1;i>=0;i--)if("videoinput"===t[i].kind){var r=t[i],s=t[i].deviceId;this.deviceMsg("device"+i+":",r,!1),e.deviceList.push(s)}}deviceSuccess(e){this.deviceSelected=!0,e.callbackDevices()}deviceListCheck(){if(this.deviceMsg("device ids",this.deviceList+" "+this.deviceSelected,!1),!this.deviceSelected){var e=this.deviceList[0];this.deviceSelected=!0,this.setDeviceMediaConstraintsId(APP.mediaDevices.parameters,e)}}onError(e){var t=!1,i=e.name;null!=i&&this.errorHandling(i)&&(t=!0),t||this.deviceMsg("device error:",e,!0)}errorHandling(e){return"NotAllowedError"==e&&"ios"==this.info.os&&"safari"==this.info.browser&&(this.deviceAlert('Please turn on "Camera & Microphone Access" in Settings > Safari and reload app.'),!0)}checkChineseBrowser(){var e="Other",t=window.navigator.userAgent,i={Sogou:/SE\s2\.X|SogouMobileBrowser/,Explorer2345:/2345Explorer|2345chrome|Mb2345Browser/,Liebao:/LBBROWSER/,Wechat:/MicroMessenger/,QQBrowser:/QQBrowser/,Baidu:/BIDUBrowser|baidubrowser|BaiduHD/,UC:/UBrowser|UCBrowser|UCWEB/,MiuiBrowser:/MiuiBrowser/,MobileQQ:/Mobile\/\w{5,}\sQQ\/(\d+[\.\d]+)/,Shoujibaidu:/baiduboxapp/,SamsungBrowser:/samsungbrowser/,Firefox:/Firefox/,Maxthon:/Maxthon/,Se360:/360SE/,Ee360:/360EE/,TheWorld:/TheWorld/,Weibo:/__weibo__/,NokiaBrowser:/NokiaBrowser/,Opera:/Opera|OPR\/(\d+[\.\d]+)/,Edge:/Edge/,QQLive:/QQLive(HD)?Browser/,Letv:/LetvClient/,Youku:/Youku/,AndroidBrowser:/Android.*Mobile\sSafari|Android\/(\d[\.\d]+)\sRelease\/(\d[\.\d]+)\sBrowser\/AppleWebKit(\d[\.\d]+)/i,IE:/Trident|MSIE/,toutiao:/NewsArticle/,Chrome:/Chrome|CriOS/,Safari:/Version[|\/]([\w.]+)(\s\w.+)?\s?Safari|like\sGecko\)\sMobile\/\w{3,}$/};for(var r in i)if(i[r].exec(t)){e=r;break}return e}setDevice(e,t,i){var r=this;return navigator.mediaDevices.enumerateDevices().then(function(s){var o={audio:!1,video:{facingMode:"environment",width:{ideal:t.sourceWidth},height:{ideal:t.sourceHeight}}};null!==t.deviceId&&(o.video.deviceId={exact:t.deviceId}),navigator.mediaDevices.getUserMedia(o).then(function(t){i.srcObject=t,document.body.addEventListener("click",function(){i.play()});var r=setInterval(function(){i.videoWidth&&(e.onReady(),clearInterval(r))},20)}).catch(function(e){r.onError({name:e.name,message:e.message})})}).catch(function(e){r.onError({message:e.message})}),i}deviceDebug1(){var e=this;null!=APP.debug&&(APP.debug.devices.video={},navigator.mediaDevices.enumerateDevices().then(function(e){let t=[];for(var i=e.length-1;i>=0;i--)if("videoinput"===e[i].kind){e[i].label;t.push(e[i])}}).catch(function(t){e.onError({message:t.message})})),console.log(APP.debug.devices)}addDebug(e,t){console.log(e),console.log(t)}}window.APP={},window.AKIT={};window.akit=new class{constructor(){this.properties(),this.host=window.APP.host,this.objdir=window.APP.objDir,this.aframe=new a,window.AKIT.devices=new Ee,window.APP.run=new Re}properties(){APP.platformAR=AKIT_PROPS.platform,console.log("properties:",AKIT_PROPS)}init(){console.log("akit-start init"),this.initKit(),this.startKit()}start(){console.log("akit-start start"),this.startAR()}cycle(){AKIT.running&&APP.run.app.cycle()}initKit(){window.APP.run.parentSet(this),window.APP.run.init()}startKit(){this.setAR(),this.callAR()}stop(){window.APP.run.stop()}load(e){window.APP.run.load(e)}cycleStart(){this.running||(this.running=!0)}devices(){}call(e,t){}setAR(){window.AKIT.devices.initMediaDevices(this)}callbackDevices(){console.log("ar view callback"),this.aframe.init()}startAR(){APP.sourceAR=document.getElementById("appscene"),this.startARPlatform(),console.log("start-source",APP.sourceAR)}callAR(){console.log("ar view call"),this.initARPlatform()}initARPlatform(){this.startedARCheck()||(window.APP.run.app.startAR("arjs"),this.cycleStart()),this.loadAR()}startARPlatform(){this.setElement(),window.APP.run.start()}startedARCheck(){return window.APP.run.app.startedARCheck()}loadAR(){window.APP.run.app.loadAR()}stopAR(){window.APP.run.app.stopAR()}startedVRCheck(){return window.APP.run.app.startedVRCheck()}loadVR(){window.APP.run.app.loadVR()}startVR(e){window.APP.run.app.startVR(e)}stopVR(){window.APP.run.app.stopVR()}setSceneWindow(){window.APP.run.app.setSceneWindow()}setElement(){window.APP.run.app.setElement1()}setCanvas(){window.APP.run.app.setCanvas1()}setVideoElement(){window.APP.run.app.setVideoElement()}objectAnchor(e,t,i,r){let s={name:e,group:t,object:r,marker:i,title:"",desc:""};window.APP.run.app.objectAnchor(s)}object(e,t,i,r,s,o,a){console.log("obj",e,t,i,r,s,o,a);let n={name:e,group:t,dir:i,filetype:s,marker:r,title:o,desc:a};window.APP.run.app.object(n)}loadObjects(e){return window.APP.run.app.objectsLoad(e)}setObjects(e,t){const i=this.host+t+e+".json",r=this.getURL(i);console.log(r)}objects(e,t){console.log("objs",e,t)}getURL(e){return e}triggerUpdated(e){console.log("triggerUpdated",e)}triggerUpdatedMarker(e){console.log("triggerUpdatedMarker",e)}markerVisibleUpdated(e){console.log("markerVisibleUpdated",e)}}}();
